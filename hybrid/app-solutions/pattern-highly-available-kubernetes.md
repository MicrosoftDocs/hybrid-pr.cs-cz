---
title: Kubernetes vzor vysoké dostupnosti s využitím Azure a centra Azure Stack
description: Naučte se, jak řešení clusteru Kubernetes poskytuje vysokou dostupnost pomocí Azure a centra Azure Stack.
author: BryanLa
ms.topic: article
ms.date: 12/03/2020
ms.author: bryanla
ms.reviewer: bryanla
ms.lastreviewed: 12/03/2020
ms.openlocfilehash: 454cc0a0531882b7a8ec050a461420ce13eebcfe
ms.sourcegitcommit: df7e3e6423c3d4e8a42dae3d1acfba1d55057258
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/09/2020
ms.locfileid: "96911790"
---
# <a name="high-availability-kubernetes-cluster-pattern"></a><span data-ttu-id="fbfba-103">Model clusteru Kubernetes s vysokou dostupností</span><span class="sxs-lookup"><span data-stu-id="fbfba-103">High availability Kubernetes cluster pattern</span></span>

<span data-ttu-id="fbfba-104">Tento článek popisuje, jak architektovat a provozovat vysoce dostupnou infrastrukturu založenou na Kubernetes pomocí modulu Azure Kubernetes Service (AKS) na rozbočovači Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-104">This article describes how to architect and operate a highly available Kubernetes-based infrastructure using Azure Kubernetes Service (AKS) Engine on Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-105">Tento scénář je společný pro organizace s důležitými úlohami ve vysoce omezených a regulovaných prostředích.</span><span class="sxs-lookup"><span data-stu-id="fbfba-105">This scenario is common for organizations with critical workloads in highly restricted and regulated environments.</span></span> <span data-ttu-id="fbfba-106">Organizace v doménách, jako jsou finance, obrana a státní správa.</span><span class="sxs-lookup"><span data-stu-id="fbfba-106">Organizations in domains such as finance, defense, and government.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="fbfba-107">Kontext a problém</span><span class="sxs-lookup"><span data-stu-id="fbfba-107">Context and problem</span></span>

<span data-ttu-id="fbfba-108">Mnoho organizací vyvíjí nativní řešení cloudu, které využívá špičkové služby a technologie, jako je Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-108">Many organizations are developing cloud-native solutions that leverage state-of-the-art services and technologies like Kubernetes.</span></span> <span data-ttu-id="fbfba-109">I když Azure poskytuje datacentra ve většině oblastí světa, někdy existují oblasti použití hraničního prostředí a scénáře, kdy je potřeba, aby podnikové kritické aplikace běžely v určitém umístění.</span><span class="sxs-lookup"><span data-stu-id="fbfba-109">Although Azure provides datacenters in most regions of the world, sometimes there are edge use-cases and scenarios where business critical applications must run in a specific location.</span></span> <span data-ttu-id="fbfba-110">K důležitým hlediskům patří:</span><span class="sxs-lookup"><span data-stu-id="fbfba-110">Considerations include:</span></span>

- <span data-ttu-id="fbfba-111">Citlivost na umístění</span><span class="sxs-lookup"><span data-stu-id="fbfba-111">Location sensitivity</span></span>
- <span data-ttu-id="fbfba-112">Latence mezi aplikací a místními systémy</span><span class="sxs-lookup"><span data-stu-id="fbfba-112">Latency between the application and on-premises systems</span></span>
- <span data-ttu-id="fbfba-113">Zachování šířky pásma</span><span class="sxs-lookup"><span data-stu-id="fbfba-113">Bandwidth conservation</span></span>
- <span data-ttu-id="fbfba-114">Připojení</span><span class="sxs-lookup"><span data-stu-id="fbfba-114">Connectivity</span></span>
- <span data-ttu-id="fbfba-115">Zákonné nebo zákonné požadavky</span><span class="sxs-lookup"><span data-stu-id="fbfba-115">Regulatory or statutory requirements</span></span>

<span data-ttu-id="fbfba-116">Azure, v kombinaci s Azure Stack hub, řeší většinu těchto otázek.</span><span class="sxs-lookup"><span data-stu-id="fbfba-116">Azure, in combination with Azure Stack Hub, addresses most of these concerns.</span></span> <span data-ttu-id="fbfba-117">V následující části je popsána široká sada možností, rozhodnutí a důležitých informací pro úspěšnou implementaci Kubernetes běžící v centru Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-117">A broad set of options, decisions, and considerations for a successful implementation of Kubernetes running on Azure Stack Hub is described below.</span></span>

## <a name="solution"></a><span data-ttu-id="fbfba-118">Řešení</span><span class="sxs-lookup"><span data-stu-id="fbfba-118">Solution</span></span>

<span data-ttu-id="fbfba-119">Tento vzor předpokládá, že musíme řešit striktní sadu omezení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-119">This pattern assumes that we have to deal with a strict set of constraints.</span></span> <span data-ttu-id="fbfba-120">Aplikace musí běžet místně a veškerá osobní data musí mít přístup k veřejným cloudovým službám.</span><span class="sxs-lookup"><span data-stu-id="fbfba-120">The application must run on-premises and all personal data must not reach public cloud services.</span></span> <span data-ttu-id="fbfba-121">Monitorování a další data, která nejsou PII, se dají do Azure Odeslat a zpracovat tam.</span><span class="sxs-lookup"><span data-stu-id="fbfba-121">Monitoring and other non-PII data can be sent to Azure and be processed there.</span></span> <span data-ttu-id="fbfba-122">Externím službám, jako jsou veřejné Container Registry nebo jiné, se dá přistupovat, ale můžou se filtrovat přes bránu firewall nebo proxy server.</span><span class="sxs-lookup"><span data-stu-id="fbfba-122">External services like a public Container Registry or others can be accessed but might be filtered through a firewall or proxy server.</span></span>

<span data-ttu-id="fbfba-123">Ukázková aplikace uvedená tady (na základě [služby Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) je navržená tak, aby používala řešení nativní pro Kubernetes, kdykoli to bude možné.</span><span class="sxs-lookup"><span data-stu-id="fbfba-123">The sample application shown here (based on [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) is designed to use Kubernetes-native solutions whenever possible.</span></span> <span data-ttu-id="fbfba-124">Tento návrh zabraňuje zamčení dodavatele namísto použití služeb nativního pro platformu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-124">This design avoids vendor lock-in, instead of using platform-native services.</span></span> <span data-ttu-id="fbfba-125">Jako příklad používá aplikace jako hostitele back-end MongoDB Database namísto služby PaaS nebo externí databázové služby.</span><span class="sxs-lookup"><span data-stu-id="fbfba-125">As an example, the application uses a self-hosted MongoDB database backend instead of a PaaS service or external database service.</span></span>

<span data-ttu-id="fbfba-126">[![Hybridní vzor aplikace](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="fbfba-126">[![Application Pattern Hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span></span>

<span data-ttu-id="fbfba-127">Předchozí diagram znázorňuje architekturu aplikace ukázkové aplikace spuštěné v Kubernetes na rozbočovači Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-127">The preceding diagram illustrates the application architecture of the sample application running on Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-128">Aplikace se skládá z několika součástí, včetně:</span><span class="sxs-lookup"><span data-stu-id="fbfba-128">The app consists of several components, including:</span></span>

 1) <span data-ttu-id="fbfba-129">Cluster AKS založený na stroji Kubernetes na rozbočovači Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-129">An AKS Engine based Kubernetes cluster on Azure Stack Hub.</span></span>
 2) <span data-ttu-id="fbfba-130">[správce certifikace](https://www.jetstack.io/cert-manager/), který poskytuje sadu nástrojů pro správu certifikátů v Kubernetes, který slouží k automatickému vyžádání certifikátů pomocí šifrování.</span><span class="sxs-lookup"><span data-stu-id="fbfba-130">[cert-manager](https://www.jetstack.io/cert-manager/), which provides a suite of tools for certificate management in Kubernetes, used to automatically request certificates from Let's Encrypt.</span></span>
 3) <span data-ttu-id="fbfba-131">Obor názvů Kubernetes, který obsahuje komponenty aplikace pro front-end (hodnocení – Web), rozhraní API (hodnocení – API) a databázi (hodnocení-MongoDB).</span><span class="sxs-lookup"><span data-stu-id="fbfba-131">A Kubernetes namespace that contains the application components for the front end (ratings-web), api (ratings-api), and database (ratings-mongodb).</span></span>
 4) <span data-ttu-id="fbfba-132">Kontroler příchozích dat, který směruje provoz HTTP/HTTPS do koncových bodů v rámci clusteru Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-132">The Ingress Controller that routes HTTP/HTTPS traffic to endpoints within the Kubernetes cluster.</span></span>

<span data-ttu-id="fbfba-133">Ukázková aplikace se používá k ilustraci architektury aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-133">The sample application is used to illustrate the application architecture.</span></span> <span data-ttu-id="fbfba-134">Všechny komponenty jsou příklady.</span><span class="sxs-lookup"><span data-stu-id="fbfba-134">All components are examples.</span></span> <span data-ttu-id="fbfba-135">Architektura obsahuje jenom jedno nasazení aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-135">The architecture contains only a single application deployment.</span></span> <span data-ttu-id="fbfba-136">Abychom dosáhli vysoké dostupnosti (HA), spustíme nasazení minimálně dvakrát na dvou různých instancích centra Azure Stack – můžou běžet buď ve stejném umístění, nebo ve dvou (nebo více) různých lokalitách:</span><span class="sxs-lookup"><span data-stu-id="fbfba-136">To achieve high availability (HA), we'll run the deployment at least twice on two different Azure Stack Hub instances - they can run either in the same location or in two (or more) different sites:</span></span>

![Architektura infrastruktury](media/pattern-highly-available-kubernetes/aks-azure-architecture.png)

<span data-ttu-id="fbfba-138">Služby, jako jsou Azure Container Registry, Azure Monitor a další, se hostují mimo Azure Stack centrum v Azure nebo místně.</span><span class="sxs-lookup"><span data-stu-id="fbfba-138">Services like Azure Container Registry, Azure Monitor, and others, are hosted outside Azure Stack Hub in Azure or on-premises.</span></span> <span data-ttu-id="fbfba-139">Tento hybridní návrh chrání řešení před výpadkem jedné instance centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-139">This hybrid design protects the solution against outage of a single Azure Stack Hub instance.</span></span>

## <a name="components"></a><span data-ttu-id="fbfba-140">Komponenty</span><span class="sxs-lookup"><span data-stu-id="fbfba-140">Components</span></span>

<span data-ttu-id="fbfba-141">Celková architektura se skládá z následujících součástí:</span><span class="sxs-lookup"><span data-stu-id="fbfba-141">The overall architecture consists of the following components:</span></span>

<span data-ttu-id="fbfba-142">**Centrum Azure Stack** je rozšířením Azure, které může spouštět úlohy v místním prostředí tím, že poskytuje služby Azure ve vašem datovém centru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-142">**Azure Stack Hub** is an extension of Azure that can run workloads in an on-premises environment by providing Azure services in your datacenter.</span></span> <span data-ttu-id="fbfba-143">Další informace najdete v článku [Přehled centra Azure Stack](/azure-stack/operator/azure-stack-overview) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-143">Go to [Azure Stack Hub overview](/azure-stack/operator/azure-stack-overview) to learn more.</span></span>

<span data-ttu-id="fbfba-144">Modul **AKS (Azure Kubernetes Service Engine)** je modul, na kterém se nachází služba Azure Kubernetes Service (AKS), která je v Azure ještě dnes dostupná.</span><span class="sxs-lookup"><span data-stu-id="fbfba-144">**Azure Kubernetes Service Engine (AKS Engine)** is the engine behind the managed Kubernetes service offering, Azure Kubernetes Service (AKS), that is available in Azure today.</span></span> <span data-ttu-id="fbfba-145">V případě centra Azure Stack umožňuje modul AKS nasadit, škálovat a upgradovat plně vybavené a samoobslužné clustery Kubernetes s využitím IaaS možností centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-145">For Azure Stack Hub, AKS Engine allows us to deploy, scale, and upgrade fully featured, self-managed Kubernetes clusters using Azure Stack Hub's IaaS capabilities.</span></span> <span data-ttu-id="fbfba-146">Další informace najdete v článku [Přehled modulu AKS](https://github.com/Azure/aks-engine) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-146">Go to [AKS Engine Overview](https://github.com/Azure/aks-engine) to learn more.</span></span>

<span data-ttu-id="fbfba-147">Pokud se chcete dozvědět víc o rozdílech mezi modulem AKS v Azure a modulem AKS v centru Azure Stack, přečtěte si o [známých problémech a omezeních](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-147">Go to [Known Issues and Limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) to learn more about the differences between AKS Engine on Azure and AKS Engine on Azure Stack Hub.</span></span>

<span data-ttu-id="fbfba-148">Služba **Azure Virtual Network (VNET)** slouží k poskytování síťové infrastruktury v každém centru Azure Stack pro Virtual Machines (virtuální počítače) hostující infrastrukturu clusteru Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-148">**Azure Virtual Network (VNet)** is used to provide the network infrastructure on each Azure Stack Hub for the Virtual Machines (VMs) hosting the Kubernetes cluster infrastructure.</span></span>

<span data-ttu-id="fbfba-149">**Azure Load Balancer** se používá pro koncový bod rozhraní API Kubernetes a kontroler Nginx pro příchozí přenosy.</span><span class="sxs-lookup"><span data-stu-id="fbfba-149">**Azure Load Balancer** is used for the Kubernetes API Endpoint and the Nginx Ingress Controller.</span></span> <span data-ttu-id="fbfba-150">Nástroj pro vyrovnávání zatížení směruje externí provoz (například Internet) do uzlů a virtuálních počítačů, které nabízejí konkrétní službu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-150">The load balancer routes external (for example, Internet) traffic to nodes and VMs offering a specific service.</span></span>

<span data-ttu-id="fbfba-151">**Azure Container Registry (ACR)** se používá k ukládání privátních imagí Docker a grafů Helm, které se nasazují do clusteru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-151">**Azure Container Registry (ACR)** is used to store private Docker images and Helm charts, which are deployed to the cluster.</span></span> <span data-ttu-id="fbfba-152">Modul AKS se může ověřit s Container Registry pomocí identity Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fbfba-152">AKS Engine can authenticate with the Container Registry using an Azure AD identity.</span></span> <span data-ttu-id="fbfba-153">Kubernetes nevyžaduje ACR.</span><span class="sxs-lookup"><span data-stu-id="fbfba-153">Kubernetes doesn't require ACR.</span></span> <span data-ttu-id="fbfba-154">Můžete použít jiné Registry kontejnerů, jako je například Docker Hub.</span><span class="sxs-lookup"><span data-stu-id="fbfba-154">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="fbfba-155">**Azure Repos** je sada nástrojů pro správu verzí, které lze použít ke správě kódu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-155">**Azure Repos** is a set of version control tools that you can use to manage your code.</span></span> <span data-ttu-id="fbfba-156">Můžete také použít GitHub nebo jiná úložiště založená na Gitu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-156">You can also use GitHub or other git-based repositories.</span></span> <span data-ttu-id="fbfba-157">Další informace najdete v článku [přehled Azure Repos](/azure/devops/repos/get-started/what-is-repos) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-157">Go to [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) to learn more.</span></span>

<span data-ttu-id="fbfba-158">**Azure Pipelines** je součástí Azure DevOps Services a spouští automatizované sestavení, testy a nasazení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-158">**Azure Pipelines** is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="fbfba-159">Můžete také použít řešení CI/CD třetí strany, jako je například Jenkinse.</span><span class="sxs-lookup"><span data-stu-id="fbfba-159">You can also use third-party CI/CD solutions such as Jenkins.</span></span> <span data-ttu-id="fbfba-160">Další informace najdete v článku [Přehled kanálu Azure](/azure/devops/pipelines/get-started/what-is-azure-pipelines) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-160">Go to [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) to learn more.</span></span>

<span data-ttu-id="fbfba-161">**Azure monitor** shromažďuje a ukládá metriky a protokoly, včetně metrik platforem pro služby Azure v telemetrie řešení a aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-161">**Azure Monitor** collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="fbfba-162">Tato data slouží k monitorování aplikace, nastavení výstrah a řídicích panelů a k analýze selhání hlavní příčiny.</span><span class="sxs-lookup"><span data-stu-id="fbfba-162">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="fbfba-163">Azure Monitor se integruje s Kubernetes ke shromažďování metrik z řadičů, uzlů a kontejnerů a také protokolů kontejnerů a protokolů hlavního uzlu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-163">Azure Monitor integrates with Kubernetes to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span> <span data-ttu-id="fbfba-164">Další informace najdete v článku [přehled Azure monitor](/azure/azure-monitor/overview) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-164">Go to [Azure Monitor Overview](/azure/azure-monitor/overview) to learn more.</span></span>

<span data-ttu-id="fbfba-165">**Azure Traffic Manager** je nástroj pro vyrovnávání zatížení založený na DNS, který umožňuje distribuci provozu optimálně do služeb napříč různými oblastmi Azure nebo nasazeními centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-165">**Azure Traffic Manager** is a DNS-based traffic load balancer that enables you to distribute traffic optimally to services across different Azure regions or Azure Stack Hub deployments.</span></span> <span data-ttu-id="fbfba-166">Traffic Manager také nabízí vysokou dostupnost a rychlost odezvy.</span><span class="sxs-lookup"><span data-stu-id="fbfba-166">Traffic Manager also provides high availability and responsiveness.</span></span> <span data-ttu-id="fbfba-167">Koncové body aplikace musí být přístupné z vnějšku.</span><span class="sxs-lookup"><span data-stu-id="fbfba-167">The application endpoints must be accessible from the outside.</span></span> <span data-ttu-id="fbfba-168">K dispozici jsou také další místní řešení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-168">There are other on-premises solutions available as well.</span></span>

<span data-ttu-id="fbfba-169">**Kontroler** příchozího přenosu dat (Kubernetes) zpřístupňuje trasy HTTP (S) službám v clusteru Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-169">**Kubernetes Ingress Controller** exposes HTTP(S) routes to services in a Kubernetes cluster.</span></span> <span data-ttu-id="fbfba-170">Pro tento účel se dá použít Nginx nebo jakýkoli vhodný kontroler příchozího přenosu dat.</span><span class="sxs-lookup"><span data-stu-id="fbfba-170">Nginx or any suitable ingress controller can be used for this purpose.</span></span>

<span data-ttu-id="fbfba-171">**Helm** je správce balíčků pro nasazení Kubernetes, který poskytuje způsob, jak seskupit různé objekty Kubernetes jako nasazení, služby, tajné kódy do jediného "grafu".</span><span class="sxs-lookup"><span data-stu-id="fbfba-171">**Helm** is a package manager for Kubernetes deployment, providing a way to bundle different Kubernetes objects like Deployments, Services, Secrets, into a single "chart".</span></span> <span data-ttu-id="fbfba-172">Můžete publikovat, nasazovat, řídit správu verzí a aktualizovat objekt grafu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-172">You can publish, deploy, control version management, and update a chart  object.</span></span> <span data-ttu-id="fbfba-173">Azure Container Registry lze použít jako úložiště pro ukládání zabalených Helm grafů.</span><span class="sxs-lookup"><span data-stu-id="fbfba-173">Azure Container Registry can be used as a repository to store packaged Helm Charts.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="fbfba-174">Na co dát pozor při navrhování</span><span class="sxs-lookup"><span data-stu-id="fbfba-174">Design considerations</span></span>

<span data-ttu-id="fbfba-175">Tento model následuje několik nejdůležitějších doporučení, která jsou podrobněji vysvětlena v dalších částech tohoto článku:</span><span class="sxs-lookup"><span data-stu-id="fbfba-175">This pattern follows a few high-level considerations explained in more detail in the next sections of this article:</span></span>

- <span data-ttu-id="fbfba-176">Aplikace používá Kubernetes řešení, aby se předešlo zamčení dodavatele.</span><span class="sxs-lookup"><span data-stu-id="fbfba-176">The application uses Kubernetes-native solutions, to avoid vendor lock-in.</span></span>
- <span data-ttu-id="fbfba-177">Aplikace používá architekturu mikroslužeb.</span><span class="sxs-lookup"><span data-stu-id="fbfba-177">The application uses a microservices architecture.</span></span>
- <span data-ttu-id="fbfba-178">Rozbočovač Azure Stack nepotřebuje příchozí, ale umožňuje odchozí připojení k Internetu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-178">Azure Stack Hub doesn't need inbound but allows outbound Internet connectivity.</span></span>

<span data-ttu-id="fbfba-179">Tyto doporučené postupy se budou vztahovat i na reálné úlohy a scénáře.</span><span class="sxs-lookup"><span data-stu-id="fbfba-179">These recommended practices will apply to real-world workloads and scenarios as well.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="fbfba-180">Aspekty zabezpečení</span><span class="sxs-lookup"><span data-stu-id="fbfba-180">Scalability considerations</span></span>

<span data-ttu-id="fbfba-181">Škálovatelnost je důležité zajistit, aby uživatelé měli konzistentní, spolehlivý a dobře fungující přístup k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="fbfba-181">Scalability is important to provide users consistent, reliable, and well-performing access to the application.</span></span>

<span data-ttu-id="fbfba-182">Vzorový scénář pokrývá škálovatelnost na více vrstvách aplikačního zásobníku.</span><span class="sxs-lookup"><span data-stu-id="fbfba-182">The sample scenario covers scalability on multiple layers of the application stack.</span></span> <span data-ttu-id="fbfba-183">Tady je podrobný přehled různých vrstev:</span><span class="sxs-lookup"><span data-stu-id="fbfba-183">Here's a high-level overview of the different layers:</span></span>

| <span data-ttu-id="fbfba-184">Úroveň architektury</span><span class="sxs-lookup"><span data-stu-id="fbfba-184">Architecture level</span></span> | <span data-ttu-id="fbfba-185">Ovlivňuje</span><span class="sxs-lookup"><span data-stu-id="fbfba-185">Affects</span></span> | <span data-ttu-id="fbfba-186">Jak?</span><span class="sxs-lookup"><span data-stu-id="fbfba-186">How?</span></span> |
| --- | --- | ---
| <span data-ttu-id="fbfba-187">Aplikace</span><span class="sxs-lookup"><span data-stu-id="fbfba-187">Application</span></span> | <span data-ttu-id="fbfba-188">Aplikace</span><span class="sxs-lookup"><span data-stu-id="fbfba-188">Application</span></span> | <span data-ttu-id="fbfba-189">Horizontální škálování na základě počtu lusků/replik/Container Instances \*</span><span class="sxs-lookup"><span data-stu-id="fbfba-189">Horizontal scaling based on the number of Pods/Replicas/Container Instances\*</span></span> |
| <span data-ttu-id="fbfba-190">Cluster</span><span class="sxs-lookup"><span data-stu-id="fbfba-190">Cluster</span></span> | <span data-ttu-id="fbfba-191">Cluster Kubernetes</span><span class="sxs-lookup"><span data-stu-id="fbfba-191">Kubernetes cluster</span></span> | <span data-ttu-id="fbfba-192">Počet uzlů (mezi 1 a 50), virtuální počítače-SKU-velikosti a fondy uzlů (modul AKS na rozbočovači Azure Stack aktuálně podporuje pouze jeden fond uzlů); použití příkazu Scale AKS Engine (ruční)</span><span class="sxs-lookup"><span data-stu-id="fbfba-192">Number of Nodes (between 1 and 50), VM-SKU-sizes, and Node Pools (AKS Engine on Azure Stack Hub currently supports only a single node pool); using AKS Engine's scale command (manual)</span></span> |
| <span data-ttu-id="fbfba-193">Infrastruktura</span><span class="sxs-lookup"><span data-stu-id="fbfba-193">Infrastructure</span></span> | <span data-ttu-id="fbfba-194">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="fbfba-194">Azure Stack Hub</span></span> | <span data-ttu-id="fbfba-195">Počet uzlů, kapacity a jednotek škálování v rámci nasazení Azure Stackového centra</span><span class="sxs-lookup"><span data-stu-id="fbfba-195">Number of nodes, capacity, and scale units within an Azure Stack Hub deployment</span></span> |

<span data-ttu-id="fbfba-196">\* Používá se Kubernetes ' Horizontal pod autoscaleer (HPA); Automatizovaná škála založená na metrikách nebo vertikální škálování podle velikosti kontejnerových instancí (CPU/paměť).</span><span class="sxs-lookup"><span data-stu-id="fbfba-196">\* Using Kubernetes' Horizontal Pod Autoscaler (HPA); automated metric-based scaling or vertical scaling by sizing the container instances (cpu/memory).</span></span>

<span data-ttu-id="fbfba-197">**Centrum Azure Stack (úroveň infrastruktury)**</span><span class="sxs-lookup"><span data-stu-id="fbfba-197">**Azure Stack Hub (infrastructure level)**</span></span>

<span data-ttu-id="fbfba-198">Infrastruktura centra Azure Stack je základem této implementace, protože centrum Azure Stack běží na fyzickém hardwaru v datacentru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-198">The Azure Stack Hub infrastructure is the foundation of this implementation, because Azure Stack Hub runs on physical hardware in a datacenter.</span></span> <span data-ttu-id="fbfba-199">Při výběru hardwaru vašeho rozbočovače je třeba provést volby pro CPU, hustotu paměti, konfiguraci úložiště a počet serverů.</span><span class="sxs-lookup"><span data-stu-id="fbfba-199">When selecting your Hub hardware, you need to make choices for CPU, memory density, storage configuration, and number of servers.</span></span> <span data-ttu-id="fbfba-200">Další informace o škálovatelnosti centra Azure Stack najdete v následujících materiálech:</span><span class="sxs-lookup"><span data-stu-id="fbfba-200">To learn more about Azure Stack Hub's scalability, check out the following resources:</span></span>

- [<span data-ttu-id="fbfba-201">Přehled plánování kapacity pro Azure Stack centra</span><span class="sxs-lookup"><span data-stu-id="fbfba-201">Capacity planning for Azure Stack Hub overview</span></span>](/azure-stack/operator/azure-stack-capacity-planning-overview)
- [<span data-ttu-id="fbfba-202">Přidání dalších uzlů jednotek škálování do centra Azure Stack</span><span class="sxs-lookup"><span data-stu-id="fbfba-202">Add additional scale unit nodes in Azure Stack Hub</span></span>](/azure-stack/operator/azure-stack-add-scale-node)

<span data-ttu-id="fbfba-203">**Cluster Kubernetes (úroveň clusteru)**</span><span class="sxs-lookup"><span data-stu-id="fbfba-203">**Kubernetes cluster (cluster level)**</span></span>

<span data-ttu-id="fbfba-204">Samotný cluster Kubernetes se skládá z a je postaven na IaaS komponentách Azure (Stack), včetně výpočetních, úložných a síťových prostředků.</span><span class="sxs-lookup"><span data-stu-id="fbfba-204">The Kubernetes cluster itself consists of, and is built on top of Azure (Stack) IaaS components including compute, storage, and network resources.</span></span> <span data-ttu-id="fbfba-205">Řešení Kubernetes zahrnují hlavní a pracovní uzly, které se nasazují jako virtuální počítače v Azure (a centrum Azure Stack).</span><span class="sxs-lookup"><span data-stu-id="fbfba-205">Kubernetes solutions involve master and worker nodes, which are deployed as VMs in Azure (and Azure Stack Hub).</span></span>

- <span data-ttu-id="fbfba-206">[Řídicí uzly ovládacích prvků](/azure/aks/concepts-clusters-workloads#control-plane) (hlavní) poskytují základní služby Kubernetes a orchestraci úloh aplikací.</span><span class="sxs-lookup"><span data-stu-id="fbfba-206">[Control plane nodes](/azure/aks/concepts-clusters-workloads#control-plane) (master) provide the core Kubernetes services and orchestration of application workloads.</span></span>
- <span data-ttu-id="fbfba-207">[Pracovní uzly](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (Worker) spouštějí úlohy vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-207">[Worker nodes](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) run your application workloads.</span></span>

<span data-ttu-id="fbfba-208">Při výběru velikostí virtuálních počítačů pro počáteční nasazení je k dispozici několik důležitých informací:</span><span class="sxs-lookup"><span data-stu-id="fbfba-208">When selecting VM sizes for the initial deployment, there are several considerations:</span></span>  

- <span data-ttu-id="fbfba-209">**Náklady** – při plánování pracovních uzlů mějte na paměti celkové náklady na virtuální počítač, který se vám bude účtovat.</span><span class="sxs-lookup"><span data-stu-id="fbfba-209">**Cost** - When planning your worker nodes, keep in mind the overall cost per VM you'll incur.</span></span> <span data-ttu-id="fbfba-210">Pokud například úlohy vaší aplikace vyžadují omezené prostředky, měli byste naplánovat nasazení virtuálních počítačů s menší velikostí.</span><span class="sxs-lookup"><span data-stu-id="fbfba-210">For example, if your application workloads require limited resources, you should plan to deploy smaller sized VMs.</span></span> <span data-ttu-id="fbfba-211">Centrum Azure Stack, jako je Azure, se obvykle účtuje na základě spotřeby, takže vhodně navýšení velikosti virtuálních počítačů pro role Kubernetes je klíčové pro optimalizaci nákladů na spotřebu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-211">Azure Stack Hub, like Azure, is normally billed on a consumption basis, so appropriately sizing the VMs for Kubernetes roles is crucial to optimizing consumption costs.</span></span> 

- <span data-ttu-id="fbfba-212">**Škálovatelnost clusteru** se dosahuje tím, že se škáluje a rozchází na počet hlavních a pracovních uzlů nebo přidáním dalších fondů uzlů (není k dispozici v Azure Stack hub ještě dnes).</span><span class="sxs-lookup"><span data-stu-id="fbfba-212">**Scalability** - Scalability of the cluster is achieved by scaling in and out the number of master and worker nodes, or by adding additional node pools (not available on Azure Stack Hub today).</span></span> <span data-ttu-id="fbfba-213">Škálování clusteru se dá udělat na základě dat o výkonu, shromážděných pomocí kontejneru Insights (Azure Monitor + Log Analytics).</span><span class="sxs-lookup"><span data-stu-id="fbfba-213">Scaling the cluster can be done based on performance data, collected using Container Insights (Azure Monitor + Log Analytics).</span></span> 

    <span data-ttu-id="fbfba-214">Pokud vaše aplikace potřebuje více (nebo méně) prostředků, můžete horizontální navýšení kapacity (nebo v nich) horizontálně škálovat (mezi 1 a 50 uzly).</span><span class="sxs-lookup"><span data-stu-id="fbfba-214">If your application needs more (or fewer) resources, you can scale out (or in) your current nodes horizontally (between 1 and 50 nodes).</span></span> <span data-ttu-id="fbfba-215">Pokud potřebujete více než 50 uzlů, můžete vytvořit další cluster v samostatném předplatném.</span><span class="sxs-lookup"><span data-stu-id="fbfba-215">If you need more than 50 nodes, you can create an additional cluster in a separate subscription.</span></span> <span data-ttu-id="fbfba-216">Nemůžete vertikálně škálovat skutečné virtuální počítače na jinou velikost virtuálního počítače bez opětovného nasazení clusteru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-216">You can't scale up the actual VMs vertically to another VM size without redeploying the cluster.</span></span>

    <span data-ttu-id="fbfba-217">Škálování se provádí ručně pomocí AKS pomocníka pro modul, který se původně použil k nasazení clusteru Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-217">Scaling is done manually using the AKS Engine helper VM that was used to deploy the Kubernetes cluster initially.</span></span> <span data-ttu-id="fbfba-218">Další informace najdete v tématu [škálování clusterů Kubernetes](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-218">For more information, see [Scaling Kubernetes clusters](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span></span>

- <span data-ttu-id="fbfba-219">**Kvóty** – uvažujte o [kvótách](/azure-stack/operator/azure-stack-quota-types) , které jste nakonfigurovali při plánování nasazení AKS na svém rozbočovači Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-219">**Quotas** - Consider the [quotas](/azure-stack/operator/azure-stack-quota-types) you've configured when planning out an AKS deployment on your Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-220">Ujistěte se, že má každé [předplatné](/azure-stack/operator/service-plan-offer-subscription-overview) správné plány a nakonfigurované kvóty.</span><span class="sxs-lookup"><span data-stu-id="fbfba-220">Make sure each [subscription](/azure-stack/operator/service-plan-offer-subscription-overview) has the proper plans and the quotas configured.</span></span> <span data-ttu-id="fbfba-221">Předplatné bude muset při horizontálním navýšení kapacity přizpůsobit množství výpočetních prostředků, úložiště a dalších služeb potřebných pro vaše clustery.</span><span class="sxs-lookup"><span data-stu-id="fbfba-221">The subscription will need to accommodate the amount of compute, storage, and other services needed for your clusters as they scale out.</span></span>

- <span data-ttu-id="fbfba-222">**Aplikační úlohy** – [Koncepty clusterů a úloh](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) najdete v tématu Koncepty Kubernetes Core pro dokument služby Azure Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-222">**Application workloads** - Refer to the [Clusters and workloads concepts](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in the Kubernetes core concepts for Azure Kubernetes Service document.</span></span> <span data-ttu-id="fbfba-223">Tento článek vám pomůže určit rozsah správné velikosti virtuálních počítačů na základě výpočetních a paměťových potřeb vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-223">This article will help you scope the proper VM size based on the compute and memory needs of your application.</span></span>  

<span data-ttu-id="fbfba-224">**Aplikace (úroveň aplikace)**</span><span class="sxs-lookup"><span data-stu-id="fbfba-224">**Application (application level)**</span></span>

<span data-ttu-id="fbfba-225">V aplikační vrstvě používáme Kubernetes [horizontálně pod autoscaleer (hPa)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span><span class="sxs-lookup"><span data-stu-id="fbfba-225">On the application layer, we use Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span></span> <span data-ttu-id="fbfba-226">HPA může zvýšit nebo snížit počet replik (pod/Container Instances) v našem nasazení na základě různých metrik (například využití procesoru).</span><span class="sxs-lookup"><span data-stu-id="fbfba-226">HPA can increase or decrease the number of Replicas (Pod/Container Instances) in our deployment based on different metrics (like CPU utilization).</span></span>

<span data-ttu-id="fbfba-227">Další možností je škálovat instance kontejnerů vertikálně.</span><span class="sxs-lookup"><span data-stu-id="fbfba-227">Another option is to scale container instances vertically.</span></span> <span data-ttu-id="fbfba-228">To se dá udělat tak, že změníte velikost procesoru a paměti, která je požadovaná a dostupná pro konkrétní nasazení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-228">This can be accomplished by changing the amount of CPU and Memory requested and available for a specific deployment.</span></span> <span data-ttu-id="fbfba-229">Další informace najdete v tématu [Správa prostředků pro kontejnery](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) v Kubernetes.IO.</span><span class="sxs-lookup"><span data-stu-id="fbfba-229">See [Managing Resources for Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) on kubernetes.io to learn more.</span></span>

## <a name="networking-and-connectivity-considerations"></a><span data-ttu-id="fbfba-230">Požadavky na síť a připojení</span><span class="sxs-lookup"><span data-stu-id="fbfba-230">Networking and connectivity considerations</span></span>

<span data-ttu-id="fbfba-231">Síťové a síťové připojení má vliv i na tři vrstvy zmíněné dříve pro Kubernetes v Azure Stackovém centru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-231">Networking and connectivity also affect the three layers mentioned previously for Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-232">V následující tabulce jsou uvedeny vrstvy a služby, které obsahují:</span><span class="sxs-lookup"><span data-stu-id="fbfba-232">The following table shows the layers and which services they contain:</span></span>

| <span data-ttu-id="fbfba-233">Vrstva</span><span class="sxs-lookup"><span data-stu-id="fbfba-233">Layer</span></span> | <span data-ttu-id="fbfba-234">Ovlivňuje</span><span class="sxs-lookup"><span data-stu-id="fbfba-234">Affects</span></span> | <span data-ttu-id="fbfba-235">Co?</span><span class="sxs-lookup"><span data-stu-id="fbfba-235">What?</span></span> |
| --- | --- | ---
| <span data-ttu-id="fbfba-236">Aplikace</span><span class="sxs-lookup"><span data-stu-id="fbfba-236">Application</span></span> | <span data-ttu-id="fbfba-237">Aplikace</span><span class="sxs-lookup"><span data-stu-id="fbfba-237">Application</span></span> | <span data-ttu-id="fbfba-238">Jak aplikace je přístupná?</span><span class="sxs-lookup"><span data-stu-id="fbfba-238">How is the application accessible?</span></span> <span data-ttu-id="fbfba-239">Bude zpřístupněno pro Internet?</span><span class="sxs-lookup"><span data-stu-id="fbfba-239">Will it be exposed to the Internet?</span></span> |
| <span data-ttu-id="fbfba-240">Cluster</span><span class="sxs-lookup"><span data-stu-id="fbfba-240">Cluster</span></span> | <span data-ttu-id="fbfba-241">Cluster Kubernetes</span><span class="sxs-lookup"><span data-stu-id="fbfba-241">Kubernetes cluster</span></span> | <span data-ttu-id="fbfba-242">Kubernetes API, virtuální počítač modulu AKS, načítání imagí kontejnerů (odchozí přenos), odesílání dat monitorování a telemetrie (výstup)</span><span class="sxs-lookup"><span data-stu-id="fbfba-242">Kubernetes API, AKS Engine VM, Pulling container images (egress), Sending monitoring data and telemetry (egress)</span></span> |
| <span data-ttu-id="fbfba-243">Infrastruktura</span><span class="sxs-lookup"><span data-stu-id="fbfba-243">Infrastructure</span></span> | <span data-ttu-id="fbfba-244">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="fbfba-244">Azure Stack Hub</span></span> | <span data-ttu-id="fbfba-245">Přístupnost koncových bodů správy centra Azure Stack jako koncových bodů portálu a Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="fbfba-245">Accessibility of the Azure Stack Hub management endpoints like the portal and Azure Resource Manager endpoints.</span></span> |

<span data-ttu-id="fbfba-246">**Aplikace**</span><span class="sxs-lookup"><span data-stu-id="fbfba-246">**Application**</span></span>

<span data-ttu-id="fbfba-247">V případě aplikační vrstvy je nejdůležitějším aspektem, zda je aplikace vystavená a přístupná z Internetu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-247">For the application layer, the most important consideration is whether the application is exposed and accessible from the Internet.</span></span> <span data-ttu-id="fbfba-248">V Kubernetes perspektivě Internet Accessibility znamená vystavení nasazení nebo pod pomocí služby Kubernetes nebo řadiče příchozího přenosu dat.</span><span class="sxs-lookup"><span data-stu-id="fbfba-248">From a Kubernetes perspective, Internet accessibility means exposing a deployment or pod using a Kubernetes Service or an Ingress Controller.</span></span>

> [!NOTE]
> <span data-ttu-id="fbfba-249">K vystavování služeb Kubernetes doporučujeme použití řadičů příchozího přenosu dat, protože počet veřejných IP adres front-endu na rozbočovači Azure Stack je omezený na 5.</span><span class="sxs-lookup"><span data-stu-id="fbfba-249">We recommend the use of Ingress controllers to expose Kubernetes Services as the number of Frontend public IPs on Azure Stack Hub is limited to 5.</span></span> <span data-ttu-id="fbfba-250">Tento návrh také omezuje počet služeb Kubernetes (s typem vyrovnávání zatížení) na 5, který bude pro mnoho nasazení příliš malý.</span><span class="sxs-lookup"><span data-stu-id="fbfba-250">This design also limits the number of Kubernetes Services (with the type LoadBalancer) to 5, which will be too small for many deployments.</span></span> <span data-ttu-id="fbfba-251">Další informace najdete v [dokumentaci k modulu AKS](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-251">Go to the [AKS Engine documentation](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) to learn more.</span></span>

<span data-ttu-id="fbfba-252">Vystavení aplikace pomocí veřejné IP adresy prostřednictvím Load Balancer nebo nessecarily, znamená, že je aplikace teď přístupná prostřednictvím Internetu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-252">Exposing an application using a public IP via a Load Balancer or an Ingress Controller doesn't nessecarily mean that the application is now accessible via the Internet.</span></span> <span data-ttu-id="fbfba-253">Je možné, aby centrum Azure Stack mít veřejnou IP adresu, která je viditelná jenom na místním intranetu – ne všechny veřejné IP adresy jsou skutečně internetové.</span><span class="sxs-lookup"><span data-stu-id="fbfba-253">It's possible for Azure Stack Hub to have a public IP address that is only visible on the local intranet - not all public IPs are truly Internet-facing.</span></span>

<span data-ttu-id="fbfba-254">Předchozí blok považuje příchozí přenos do aplikace za provozu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-254">The previous block considers ingress traffic to the application.</span></span> <span data-ttu-id="fbfba-255">Dalším tématem, které je potřeba vzít v úvahu pro úspěšné nasazení Kubernetes, je odchozí a výstupní provoz.</span><span class="sxs-lookup"><span data-stu-id="fbfba-255">Another topic that must be considered for a successful Kubernetes deployment is outbound/egress traffic.</span></span> <span data-ttu-id="fbfba-256">Tady je několik případů použití, které vyžadují odchozí přenosy:</span><span class="sxs-lookup"><span data-stu-id="fbfba-256">Here are a few use cases that require egress traffic:</span></span>

- <span data-ttu-id="fbfba-257">Přijímání imagí kontejneru uložených na Dockerhubu nebo Azure Container Registry</span><span class="sxs-lookup"><span data-stu-id="fbfba-257">Pulling Container Images stored on DockerHub or Azure Container Registry</span></span>
- <span data-ttu-id="fbfba-258">Načítání Helm grafů</span><span class="sxs-lookup"><span data-stu-id="fbfba-258">Retrieving Helm Charts</span></span>
- <span data-ttu-id="fbfba-259">Emitování Application Insights dat (nebo jiných dat monitorování)</span><span class="sxs-lookup"><span data-stu-id="fbfba-259">Emitting Application Insights data (or other monitoring data)</span></span>

<span data-ttu-id="fbfba-260">Některá podniková prostředí můžou vyžadovat použití _transparentních_ nebo _netransparentních_ proxy serverů.</span><span class="sxs-lookup"><span data-stu-id="fbfba-260">Some enterprise environments might require the use of _transparent_ or _non-transparent_ proxy servers.</span></span> <span data-ttu-id="fbfba-261">Tyto servery vyžadují konkrétní konfiguraci různých komponent našeho clusteru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-261">These servers require specific configuration on various components of our cluster.</span></span> <span data-ttu-id="fbfba-262">Dokumentace k modulům AKS obsahuje různé informace o tom, jak se kterými se vejdou síťové proxy.</span><span class="sxs-lookup"><span data-stu-id="fbfba-262">The AKS Engine documentation contains various details on how to accommodate network proxies.</span></span> <span data-ttu-id="fbfba-263">Další podrobnosti najdete v tématu [modul AKS a proxy servery](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-263">For more details, see [AKS Engine and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span></span>

<span data-ttu-id="fbfba-264">A konečně provoz mezi clustery musí být mezi Azure Stack instancemi centra.</span><span class="sxs-lookup"><span data-stu-id="fbfba-264">Lastly, cross-cluster traffic must flow between Azure Stack Hub instances.</span></span> <span data-ttu-id="fbfba-265">Ukázkové nasazení se skládá z jednotlivých Kubernetes clusterů běžících na jednotlivých instancích centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-265">The sample deployment consists of individual Kubernetes clusters running on individual Azure Stack Hub instances.</span></span> <span data-ttu-id="fbfba-266">Provoz mezi nimi, jako je například provoz replikace mezi dvěma databázemi, je "externí provoz".</span><span class="sxs-lookup"><span data-stu-id="fbfba-266">Traffic between them, such as the replication traffic between two databases, is "external traffic".</span></span> <span data-ttu-id="fbfba-267">Externí provoz musí být směrován prostřednictvím sítě Site-to-Site VPN nebo veřejných IP adres centra Azure Stack pro připojení Kubernetes ve dvou instancích centra Azure Stack:</span><span class="sxs-lookup"><span data-stu-id="fbfba-267">External traffic must be routed through either a Site-to-Site VPN or Azure Stack Hub Public IP addresses to connect Kubernetes on two Azure Stack Hub instances:</span></span>

![přenos mezi clustery mezi a uvnitř](media/pattern-highly-available-kubernetes/aks-inter-and-intra-cluster-traffic.png)

<span data-ttu-id="fbfba-269">**Cluster**</span><span class="sxs-lookup"><span data-stu-id="fbfba-269">**Cluster**</span></span>  

<span data-ttu-id="fbfba-270">Cluster Kubernetes nemusí být nutně přístupný prostřednictvím Internetu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-270">The Kubernetes cluster doesn't necessarily need to be accessible via the Internet.</span></span> <span data-ttu-id="fbfba-271">Relevantní část je rozhraní API Kubernetes používané k provozování clusteru, například pomocí nástroje `kubectl` .</span><span class="sxs-lookup"><span data-stu-id="fbfba-271">The relevant part is the Kubernetes API used to operate a cluster, for example, using `kubectl`.</span></span> <span data-ttu-id="fbfba-272">Koncový bod rozhraní API Kubernetes musí být přístupný všem, kdo provozuje cluster nebo nasazuje aplikace a služby nad ním.</span><span class="sxs-lookup"><span data-stu-id="fbfba-272">The Kubernetes API endpoint must be accessible to everyone who operates the cluster or deploys applications and services on top of it.</span></span> <span data-ttu-id="fbfba-273">V tomto tématu se podrobněji věnujeme DevOps perspektivě v níže uvedené části věnované [nasazení (CI/CD)](#deployment-cicd-considerations) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-273">This topic is covered in more detail from a DevOps-perspective in the [Deployment (CI/CD) considerations](#deployment-cicd-considerations) section below.</span></span>

<span data-ttu-id="fbfba-274">Na úrovni clusteru existuje také několik informací o odchozím provozu:</span><span class="sxs-lookup"><span data-stu-id="fbfba-274">On the cluster level, there are also a few considerations around egress-traffic:</span></span>

- <span data-ttu-id="fbfba-275">Aktualizace uzlů (pro Ubuntu)</span><span class="sxs-lookup"><span data-stu-id="fbfba-275">Node updates (for Ubuntu)</span></span>
- <span data-ttu-id="fbfba-276">Monitorování dat (odeslání do Azure LogAnalytics)</span><span class="sxs-lookup"><span data-stu-id="fbfba-276">Monitoring data (sent to Azure LogAnalytics)</span></span>
- <span data-ttu-id="fbfba-277">Další agenti vyžadující odchozí přenosy (specifické pro každé prostředí nasazení)</span><span class="sxs-lookup"><span data-stu-id="fbfba-277">Other agents requiring outbound traffic (specific to each deployer's environment)</span></span>

<span data-ttu-id="fbfba-278">Před nasazením clusteru Kubernetes pomocí modulu AKS si naplánujte finální návrh sítě.</span><span class="sxs-lookup"><span data-stu-id="fbfba-278">Before you deploy your Kubernetes cluster using AKS Engine, plan for the final networking design.</span></span> <span data-ttu-id="fbfba-279">Místo vytvoření vyhrazeného Virtual Network může být efektivnější nasadit cluster do existující sítě.</span><span class="sxs-lookup"><span data-stu-id="fbfba-279">Instead of creating a dedicated Virtual Network, it may be more efficient to deploy a cluster into an existing network.</span></span> <span data-ttu-id="fbfba-280">Můžete například využít existující připojení VPN typu Site-to-site, které je už nakonfigurované v prostředí centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-280">For example, you might leverage an existing Site-to-Site VPN connection already configured in your Azure Stack Hub environment.</span></span>

<span data-ttu-id="fbfba-281">**Infrastruktura**</span><span class="sxs-lookup"><span data-stu-id="fbfba-281">**Infrastructure**</span></span>  

<span data-ttu-id="fbfba-282">Infrastruktura odkazuje na přístup k koncovým bodům správy centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-282">Infrastructure refers to accessing the Azure Stack Hub management endpoints.</span></span> <span data-ttu-id="fbfba-283">K koncovým bodům patří portály tenanta a správců a koncové body správce Azure Resource Manager a tenanta.</span><span class="sxs-lookup"><span data-stu-id="fbfba-283">Endpoints include the tenant and admin portals, and the Azure Resource Manager admin and tenant endpoints.</span></span> <span data-ttu-id="fbfba-284">Tyto koncové body se vyžadují pro provoz Azure Stackho centra a jeho základních služeb.</span><span class="sxs-lookup"><span data-stu-id="fbfba-284">These endpoints are required to operate Azure Stack Hub and its core services.</span></span>

## <a name="data-and-storage-considerations"></a><span data-ttu-id="fbfba-285">Požadavky na data a úložiště</span><span class="sxs-lookup"><span data-stu-id="fbfba-285">Data and storage considerations</span></span>

<span data-ttu-id="fbfba-286">Dvě instance naší aplikace se nasadí na dva jednotlivé clustery Kubernetes ve dvou Azure Stackch instancích centra.</span><span class="sxs-lookup"><span data-stu-id="fbfba-286">Two instances of our application will be deployed, on two individual Kubernetes clusters, across two Azure Stack Hub instances.</span></span> <span data-ttu-id="fbfba-287">Tento návrh bude vyžadovat, abyste měli v úvahu, jak replikovat a synchronizovat data mezi nimi.</span><span class="sxs-lookup"><span data-stu-id="fbfba-287">This design will require us to consider how to replicate and synchronize data between them.</span></span>

<span data-ttu-id="fbfba-288">S Azure máme integrovanou možnost replikace úložiště napříč několika oblastmi a zónami v rámci cloudu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-288">With Azure, we have the built-in capability to replicate storage across multiple regions and zones within the cloud.</span></span> <span data-ttu-id="fbfba-289">V současné době s centrem Azure Stack neexistují žádné nativní způsoby, jak replikovat úložiště mezi dvěma různými instancemi centra Azure Stack – tvoří dva nezávislé cloudy s žádným způsobem, jak je spravovat jako sadu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-289">Currently with Azure Stack Hub there are no native ways to replicate storage across two different Azure Stack Hub instances - they form two independent clouds with no overarching way to manage them as a set.</span></span> <span data-ttu-id="fbfba-290">Plánování odolnosti aplikací spuštěných v rámci centra Azure Stack vynutí tuto nezávislost v návrhu a nasazeních aplikací.</span><span class="sxs-lookup"><span data-stu-id="fbfba-290">Planning for resiliency of applications running across Azure Stack Hub forces you to consider this independence in your application design and deployments.</span></span>

<span data-ttu-id="fbfba-291">Ve většině případů nebude replikace úložiště nutná pro zajištění odolné a vysoce dostupné aplikace nasazené v AKS.</span><span class="sxs-lookup"><span data-stu-id="fbfba-291">In most cases, storage replication won't be necessary for a resilient and highly available application deployed on AKS.</span></span> <span data-ttu-id="fbfba-292">V návrhu aplikací byste ale měli zvážit nezávislé úložiště na instanci centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-292">But you should consider independent storage per Azure Stack Hub instance in your application design.</span></span> <span data-ttu-id="fbfba-293">Pokud se tento návrh týká nasazení řešení v centru Azure Stack, existují možná řešení od partnerů Microsoftu, která poskytují přílohy úložiště.</span><span class="sxs-lookup"><span data-stu-id="fbfba-293">If this design is a concern or road block to deploying the solution on Azure Stack Hub, there are possible solutions from Microsoft Partners that provide storage attachments.</span></span> <span data-ttu-id="fbfba-294">Přílohy úložiště poskytují řešení replikace úložiště v rámci několika Azure Stackch Center a Azure.</span><span class="sxs-lookup"><span data-stu-id="fbfba-294">Storage attachments provide a storage replication solution across multiple Azure Stack Hubs and Azure.</span></span> <span data-ttu-id="fbfba-295">Další informace najdete v tématu [Partnerská řešení](#partner-solutions).</span><span class="sxs-lookup"><span data-stu-id="fbfba-295">For more information, see the [Partner solutions](#partner-solutions).</span></span>

<span data-ttu-id="fbfba-296">V naší architektuře byly zváženy tyto vrstvy:</span><span class="sxs-lookup"><span data-stu-id="fbfba-296">In our architecture, these layers were considered:</span></span>

<span data-ttu-id="fbfba-297">**Konfigurace**</span><span class="sxs-lookup"><span data-stu-id="fbfba-297">**Configuration**</span></span>

<span data-ttu-id="fbfba-298">Konfigurace zahrnuje konfiguraci centra Azure Stack, modulu AKS a samotného clusteru Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-298">Configuration includes the configuration of Azure Stack Hub, AKS Engine, and the Kubernetes cluster itself.</span></span> <span data-ttu-id="fbfba-299">Konfigurace by měla být co nejvíc automatizovaná a uložená jako infrastruktura jako kód v systému správy verzí založeném na Gitu, jako je Azure DevOps nebo GitHub.</span><span class="sxs-lookup"><span data-stu-id="fbfba-299">The configuration should be automated as much as possible, and stored as Infrastructure-as-Code in a Git-based version control system like Azure DevOps or GitHub.</span></span> <span data-ttu-id="fbfba-300">Tato nastavení se nedají snadno synchronizovat mezi několika nasazeními.</span><span class="sxs-lookup"><span data-stu-id="fbfba-300">These settings cannot easily be synchronized across multiple deployments.</span></span> <span data-ttu-id="fbfba-301">Proto doporučujeme uložit a použít konfiguraci z vnějšku a pomocí kanálu DevOps.</span><span class="sxs-lookup"><span data-stu-id="fbfba-301">Therefore we recommend storing and applying configuration from the outside, and using DevOps pipeline.</span></span>

<span data-ttu-id="fbfba-302">**Aplikace**</span><span class="sxs-lookup"><span data-stu-id="fbfba-302">**Application**</span></span>

<span data-ttu-id="fbfba-303">Aplikace by měla být uložená v úložišti založeném na Gitu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-303">The application should be stored in a Git-based repository.</span></span> <span data-ttu-id="fbfba-304">Pokaždé, když dojde k novému nasazení, změny aplikace nebo zotavení po havárii, můžete je snadno nasadit pomocí Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="fbfba-304">Whenever there's a new deployment, changes to the application, or disaster recovery, it can be easily deployed using Azure Pipelines.</span></span>

<span data-ttu-id="fbfba-305">**Data**</span><span class="sxs-lookup"><span data-stu-id="fbfba-305">**Data**</span></span>

<span data-ttu-id="fbfba-306">Data jsou nejdůležitějším aspektem většiny návrhů aplikací.</span><span class="sxs-lookup"><span data-stu-id="fbfba-306">Data is the most important consideration in most application designs.</span></span> <span data-ttu-id="fbfba-307">Data aplikací musí zůstat synchronizovaná mezi různými instancemi aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-307">Application data must stay in sync between the different instances of the application.</span></span> <span data-ttu-id="fbfba-308">Pokud dojde k výpadku, potřebují data taky strategii zálohování a zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="fbfba-308">Data also needs a backup and disaster recovery strategy if there's an outage.</span></span>

<span data-ttu-id="fbfba-309">Dosahování tohoto návrhu je silně závislé na technologických volbách.</span><span class="sxs-lookup"><span data-stu-id="fbfba-309">Achieving this design depends heavily on technology choices.</span></span> <span data-ttu-id="fbfba-310">Tady je několik příkladů řešení pro implementaci databáze ve vysoce dostupném režimu v centru Azure Stack:</span><span class="sxs-lookup"><span data-stu-id="fbfba-310">Here are some solution examples for implementing a database in a highly available fashion on Azure Stack Hub:</span></span>

- [<span data-ttu-id="fbfba-311">Nasazení skupiny dostupnosti SQL Server 2016 do Azure a centra Azure Stack</span><span class="sxs-lookup"><span data-stu-id="fbfba-311">Deploy a SQL Server 2016 availability group to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-sql-ha)
- [<span data-ttu-id="fbfba-312">Nasazení vysoce dostupného řešení MongoDB do Azure a centra Azure Stack</span><span class="sxs-lookup"><span data-stu-id="fbfba-312">Deploy a highly available MongoDB solution to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-mongodb-ha)

<span data-ttu-id="fbfba-313">Důležité informace týkající se práce s daty napříč více umístěními jsou ještě složitějším aspektem vysoce dostupného a odolného řešení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-313">Considerations when working with data across multiple locations is an even more complex consideration for a highly available and resilient solution.</span></span> <span data-ttu-id="fbfba-314">Rozmyslete si:</span><span class="sxs-lookup"><span data-stu-id="fbfba-314">Consider:</span></span>

- <span data-ttu-id="fbfba-315">Latence a síťové připojení mezi Azure Stackmi rozbočovači.</span><span class="sxs-lookup"><span data-stu-id="fbfba-315">Latency and network connectivity between Azure Stack Hubs.</span></span>
- <span data-ttu-id="fbfba-316">Dostupnost identit pro služby a oprávnění.</span><span class="sxs-lookup"><span data-stu-id="fbfba-316">Availability of identities for services and permissions.</span></span> <span data-ttu-id="fbfba-317">Každá instance centra Azure Stack se integruje s externím adresářem.</span><span class="sxs-lookup"><span data-stu-id="fbfba-317">Each Azure Stack Hub instance integrates with an external directory.</span></span> <span data-ttu-id="fbfba-318">Během nasazování se rozhodnete použít buď Azure Active Directory (Azure AD) nebo Active Directory Federation Services (AD FS) (ADFS).</span><span class="sxs-lookup"><span data-stu-id="fbfba-318">During deployment, you choose to use either Azure Active Directory (Azure AD) or Active Directory Federation Services (ADFS).</span></span> <span data-ttu-id="fbfba-319">V takovém případě je možné použít jedinou identitu, která může pracovat s několika nezávislými instancemi centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-319">As such, there's potential to use a single identity that can interact with multiple independent Azure Stack Hub instances.</span></span>

## <a name="business-continuity-and-disaster-recovery"></a><span data-ttu-id="fbfba-320">Provozní kontinuita a zotavení po havárii</span><span class="sxs-lookup"><span data-stu-id="fbfba-320">Business continuity and disaster recovery</span></span>

<span data-ttu-id="fbfba-321">Provozní kontinuita a zotavení po havárii (BCDR) je důležité téma v Azure Stackovém centru i v Azure.</span><span class="sxs-lookup"><span data-stu-id="fbfba-321">Business continuity and disaster recovery (BCDR) is an important topic in both Azure Stack Hub and Azure.</span></span> <span data-ttu-id="fbfba-322">Hlavní rozdíl je v tom, že v Azure Stackovém centru musí operátor spravovat celý proces BCDR.</span><span class="sxs-lookup"><span data-stu-id="fbfba-322">The main difference is that in Azure Stack Hub, the operator must manage the whole BCDR process.</span></span> <span data-ttu-id="fbfba-323">V Azure jsou části BCDR automaticky spravovány Microsoftem.</span><span class="sxs-lookup"><span data-stu-id="fbfba-323">In Azure, parts of BCDR are automatically managed by Microsoft.</span></span>

<span data-ttu-id="fbfba-324">BCDR má vliv na tytéž oblasti, které jsou uvedené v předchozích částech [data a úložiště](#data-and-storage-considerations):</span><span class="sxs-lookup"><span data-stu-id="fbfba-324">BCDR affects the same areas mentioned in the previous section [Data and storage considerations](#data-and-storage-considerations):</span></span>

- <span data-ttu-id="fbfba-325">Infrastruktura/konfigurace</span><span class="sxs-lookup"><span data-stu-id="fbfba-325">Infrastructure / Configuration</span></span>
- <span data-ttu-id="fbfba-326">Dostupnost aplikace</span><span class="sxs-lookup"><span data-stu-id="fbfba-326">Application Availability</span></span>
- <span data-ttu-id="fbfba-327">Data aplikací</span><span class="sxs-lookup"><span data-stu-id="fbfba-327">Application Data</span></span>

<span data-ttu-id="fbfba-328">Jak je uvedeno v předchozí části, tyto oblasti jsou zodpovědností operátora centra Azure Stack a mohou se lišit mezi organizacemi.</span><span class="sxs-lookup"><span data-stu-id="fbfba-328">And as mentioned in the previous section, these areas are the responsibility of the Azure Stack Hub operator and can vary between organizations.</span></span> <span data-ttu-id="fbfba-329">Plánování BCDR podle vašich dostupných nástrojů a procesů.</span><span class="sxs-lookup"><span data-stu-id="fbfba-329">Plan BCDR according to your available tools and processes.</span></span>

<span data-ttu-id="fbfba-330">**Infrastruktura a konfigurace**</span><span class="sxs-lookup"><span data-stu-id="fbfba-330">**Infrastructure and configuration**</span></span>

<span data-ttu-id="fbfba-331">Tato část se zabývá fyzickou a logickou infrastrukturou a konfigurací centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-331">This section covers the physical and logical infrastructure and the configuration of Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-332">Zahrnuje akce v prostorách správce a tenanta.</span><span class="sxs-lookup"><span data-stu-id="fbfba-332">It covers actions in the admin and the tenant spaces.</span></span>

<span data-ttu-id="fbfba-333">Operátor centra Azure Stack (nebo správce) zodpovídá za údržbu instancí centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-333">The Azure Stack Hub operator (or administrator) is responsible for maintenance of the Azure Stack Hub instances.</span></span> <span data-ttu-id="fbfba-334">Včetně součástí sítě, úložiště, identity a dalších témat, která jsou mimo rámec tohoto článku.</span><span class="sxs-lookup"><span data-stu-id="fbfba-334">Including components such as the network, storage, identity, and other topics that are outside the scope of this article.</span></span> <span data-ttu-id="fbfba-335">Další informace o konkrétních operacích Azure Stack centra najdete v následujících zdrojích informací:</span><span class="sxs-lookup"><span data-stu-id="fbfba-335">To learn more about the specifics of Azure Stack Hub operations, see the following resources:</span></span>

- [<span data-ttu-id="fbfba-336">Obnovení dat v Azure Stack centru pomocí služby Infrastructure Backup</span><span class="sxs-lookup"><span data-stu-id="fbfba-336">Recover data in Azure Stack Hub with the Infrastructure Backup Service</span></span>](/azure-stack/operator/azure-stack-backup-infrastructure-backup)
- [<span data-ttu-id="fbfba-337">Povolení zálohování centra Azure Stack z portálu pro správu</span><span class="sxs-lookup"><span data-stu-id="fbfba-337">Enable backup for Azure Stack Hub from the administrator portal</span></span>](/azure-stack/operator/azure-stack-backup-enable-backup-console)
- [<span data-ttu-id="fbfba-338">Obnovení z katastrofické ztráty dat</span><span class="sxs-lookup"><span data-stu-id="fbfba-338">Recover from catastrophic data loss</span></span>](/azure-stack/operator/azure-stack-backup-recover-data)
- [<span data-ttu-id="fbfba-339">Osvědčené postupy pro službu Infrastructure Backup</span><span class="sxs-lookup"><span data-stu-id="fbfba-339">Infrastructure Backup Service best practices</span></span>](/azure-stack/operator/azure-stack-backup-best-practices)

<span data-ttu-id="fbfba-340">Azure Stack hub je platforma a prostředky infrastruktury, na kterých budou nasazené aplikace Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-340">Azure Stack Hub is the platform and fabric on which Kubernetes applications will be deployed.</span></span> <span data-ttu-id="fbfba-341">Vlastníkem aplikace pro aplikaci Kubernetes bude uživatel centra Azure Stack s přístupem uděleným k nasazení infrastruktury aplikace potřebné pro řešení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-341">The application owner for the Kubernetes application will be a user of Azure Stack Hub, with access granted to deploy the application infrastructure needed for the solution.</span></span> <span data-ttu-id="fbfba-342">Aplikační infrastruktura v tomto případě znamená cluster Kubernetes nasazený pomocí modulu AKS a okolní služby.</span><span class="sxs-lookup"><span data-stu-id="fbfba-342">Application infrastructure in this case means the Kubernetes cluster, deployed using AKS Engine, and the surrounding services.</span></span> <span data-ttu-id="fbfba-343">Tyto součásti budou nasazeny do centra Azure Stack s omezením nabídky centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-343">These components will be deployed into Azure Stack Hub, constrained by an Azure Stack Hub offer.</span></span> <span data-ttu-id="fbfba-344">Ujistěte se, že nabídka přijatá vlastníkem aplikace Kubernetes má dostatečnou kapacitu (vyjádřená v kvótách centra Azure Stack) pro nasazení celého řešení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-344">Make sure the offer accepted by the Kubernetes application owner has sufficient capacity (expressed in Azure Stack Hub quotas) to deploy the entire solution.</span></span> <span data-ttu-id="fbfba-345">Jak je doporučeno v předchozí části, nasazení aplikace by mělo být automatizované pomocí kanálů pro nasazení infrastruktury jako kódu a nasazení, jako je Azure DevOps Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="fbfba-345">As recommended in the previous section, the application deployment should be automated using Infrastructure-as-Code and deployment pipelines like Azure DevOps Azure Pipelines.</span></span>

<span data-ttu-id="fbfba-346">Další informace o nabídkách a kvótách centra Azure Stack najdete v tématu [Přehled služeb, plánů, nabídek a předplatných centra Azure Stack](/azure-stack/operator/service-plan-offer-subscription-overview) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-346">For more information on Azure Stack Hub offers and quotas, see [Azure Stack Hub services, plans, offers, and subscriptions overview](/azure-stack/operator/service-plan-offer-subscription-overview)</span></span>

<span data-ttu-id="fbfba-347">Je důležité bezpečně uložit a uložit konfiguraci modulu AKS, včetně jeho výstupů.</span><span class="sxs-lookup"><span data-stu-id="fbfba-347">It's important to securely save and store the AKS Engine configuration including its outputs.</span></span> <span data-ttu-id="fbfba-348">Tyto soubory obsahují důvěrné informace, které se používají pro přístup ke clusteru Kubernetes, takže je potřeba je chránit před zveřejněním bez oprávnění správce.</span><span class="sxs-lookup"><span data-stu-id="fbfba-348">These files contain confidential information used to access the Kubernetes cluster, so it must be protected from being exposed to non-administrators.</span></span>

<span data-ttu-id="fbfba-349">**Dostupnost aplikace**</span><span class="sxs-lookup"><span data-stu-id="fbfba-349">**Application availability**</span></span>

<span data-ttu-id="fbfba-350">Aplikace by neměla spoléhat na zálohy nasazené instance.</span><span class="sxs-lookup"><span data-stu-id="fbfba-350">The application shouldn't rely on backups of a deployed instance.</span></span> <span data-ttu-id="fbfba-351">Jako standardní postup si aplikaci znovu nasaďte úplně podle vzorů infrastruktury jako kódu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-351">As a standard practice, redeploy the application completely following Infrastructure-as-Code patterns.</span></span> <span data-ttu-id="fbfba-352">Můžete například znovu nasadit pomocí Azure DevOps Azure Pipelines.</span><span class="sxs-lookup"><span data-stu-id="fbfba-352">For example, redeploy using Azure DevOps Azure Pipelines.</span></span> <span data-ttu-id="fbfba-353">Postup BCDR by měl zahrnovat opětovné nasazení aplikace do stejného nebo jiného clusteru Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-353">The BCDR procedure should involve the redeployment of the application to the same or another Kubernetes cluster.</span></span>

<span data-ttu-id="fbfba-354">**Data aplikací**</span><span class="sxs-lookup"><span data-stu-id="fbfba-354">**Application data**</span></span>

<span data-ttu-id="fbfba-355">Data aplikací jsou kritickou součástí pro minimalizaci ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="fbfba-355">Application data is the critical part to minimize data loss.</span></span> <span data-ttu-id="fbfba-356">V předchozí části byly popsány techniky pro replikaci a synchronizaci dat mezi dvěma (nebo více) instancemi aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-356">In the previous section, techniques to replicate and synchronize data between two (or more) instances of the application were described.</span></span> <span data-ttu-id="fbfba-357">V závislosti na infrastruktuře databáze (MySQL, MongoDB, MSSQL nebo jiné), která se používá k ukládání dat, budou k dispozici různé techniky dostupnosti a zálohování databáze, ze kterých si můžete vybrat.</span><span class="sxs-lookup"><span data-stu-id="fbfba-357">Depending on the database infrastructure (MySQL, MongoDB, MSSQL or others) used to store the data, there will be different database availability and backup techniques available to choose from.</span></span>

<span data-ttu-id="fbfba-358">K dosažení integrity se doporučuje použít tyto možnosti:</span><span class="sxs-lookup"><span data-stu-id="fbfba-358">The recommended ways to achieve integrity are to use either:</span></span>
- <span data-ttu-id="fbfba-359">Nativní řešení zálohování pro určitou databázi.</span><span class="sxs-lookup"><span data-stu-id="fbfba-359">A native backup solution for the specific database.</span></span>
- <span data-ttu-id="fbfba-360">Řešení zálohování, které oficiálně podporuje zálohování a obnovení typu databáze používaného vaší aplikací.</span><span class="sxs-lookup"><span data-stu-id="fbfba-360">A backup solution that officially supports backup and recovery of the database type used by your application.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fbfba-361">Neukládejte data záloh ve stejné instanci centra Azure Stack, kde se nachází data aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-361">Do not store your backup data on the same Azure Stack Hub instance where your application data resides.</span></span> <span data-ttu-id="fbfba-362">Úplný výpadek instance centra Azure Stack by také ohrozil vaše zálohy.</span><span class="sxs-lookup"><span data-stu-id="fbfba-362">A complete outage of the Azure Stack Hub instance would also compromise your backups.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="fbfba-363">Aspekty dostupnosti</span><span class="sxs-lookup"><span data-stu-id="fbfba-363">Availability considerations</span></span>

<span data-ttu-id="fbfba-364">Kubernetes na rozbočovači Azure Stack nasazeném prostřednictvím modulu AKS není spravovaná služba.</span><span class="sxs-lookup"><span data-stu-id="fbfba-364">Kubernetes on Azure Stack Hub deployed via AKS Engine isn't a managed service.</span></span> <span data-ttu-id="fbfba-365">Jedná se o automatizované nasazení a konfiguraci clusteru Kubernetes s využitím infrastruktury Azure jako služby (IaaS).</span><span class="sxs-lookup"><span data-stu-id="fbfba-365">It's an automated deployment and configuration of a Kubernetes cluster using Azure Infrastructure-as-a-Service (IaaS).</span></span> <span data-ttu-id="fbfba-366">V takovém případě poskytuje stejnou dostupnost jako základní infrastruktura.</span><span class="sxs-lookup"><span data-stu-id="fbfba-366">As such, it provides the same availability as the underlying infrastructure.</span></span>

<span data-ttu-id="fbfba-367">Infrastruktura centra Azure Stack je už odolná vůči selháním a poskytuje možnosti, jako jsou skupiny dostupnosti k distribuci komponent napříč více [doménami selhání a aktualizačními doménami](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span><span class="sxs-lookup"><span data-stu-id="fbfba-367">Azure Stack Hub infrastructure is already resilient to failures, and provides capabilities like Availability Sets to distribute components across multiple [fault and update domains](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span></span> <span data-ttu-id="fbfba-368">Ale základní technologie (Clustering s podporou převzetí služeb při selhání) stále při selhání hardwaru u virtuálních počítačů na ovlivněném fyzickém serveru způsobí nějaké výpadky.</span><span class="sxs-lookup"><span data-stu-id="fbfba-368">But the underlying technology (failover clustering) still incurs some downtime for VMs on an impacted physical server, if there's a hardware failure.</span></span>

<span data-ttu-id="fbfba-369">Je dobrým zvykem nasadit cluster produkčního prostředí Kubernetes i zatížení na dva (nebo víc) clustery.</span><span class="sxs-lookup"><span data-stu-id="fbfba-369">It's a good practice to deploy your production Kubernetes cluster as well as the workload to two (or more) clusters.</span></span> <span data-ttu-id="fbfba-370">Tyto clustery by se měly hostovat v různých umístěních nebo datových centrech a využívat technologie, jako je Azure Traffic Manager, ke směrování uživatelů na základě doby odezvy clusteru nebo na základě geografického prostředí.</span><span class="sxs-lookup"><span data-stu-id="fbfba-370">These clusters should be hosted in different locations or datacenters, and use technologies like Azure Traffic Manager to route users based on cluster response time or based on geography.</span></span>

![Řízení toků provozu pomocí Traffic Manager](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager.png)

<span data-ttu-id="fbfba-372">Zákazníci, kteří mají jeden cluster Kubernetes, se obvykle připojují k IP adrese služby nebo názvu DNS dané aplikace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-372">Customers who have a single Kubernetes cluster typically connect to the service IP or DNS name of a given application.</span></span> <span data-ttu-id="fbfba-373">V nasazení s více clustery by se zákazníci měli připojit k Traffic Manager názvu DNS, který odkazuje na služby a příchozí přenosy na jednotlivých clusterech Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-373">In a multi-cluster deployment, customers should connect to a Traffic Manager DNS name that points to the services/ingress on each Kubernetes cluster.</span></span>

![Použití Traffic Manager ke směrování do místního clusteru](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager-on-premises.png)

> [!NOTE]
> <span data-ttu-id="fbfba-375">Tento model je také [osvědčeným postupem pro (spravované) clustery AKS v Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span><span class="sxs-lookup"><span data-stu-id="fbfba-375">This pattern is also a [best practice for (managed) AKS clusters in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span></span>

<span data-ttu-id="fbfba-376">Samotný cluster Kubernetes, který je nasazený prostřednictvím modulu AKS, by se měl skládat z aspoň tří hlavních uzlů a dvou pracovních uzlů.</span><span class="sxs-lookup"><span data-stu-id="fbfba-376">The Kubernetes cluster itself, deployed via AKS Engine, should consist of at least three master nodes and two worker nodes.</span></span>

## <a name="identity-and-security-considerations"></a><span data-ttu-id="fbfba-377">Požadavky na identitu a zabezpečení</span><span class="sxs-lookup"><span data-stu-id="fbfba-377">Identity and security considerations</span></span>

<span data-ttu-id="fbfba-378">Informace o identitách a zabezpečení jsou důležitá témata.</span><span class="sxs-lookup"><span data-stu-id="fbfba-378">Identity and security are important topics.</span></span> <span data-ttu-id="fbfba-379">Hlavně v případě, že řešení zahrnuje nezávislé Azure Stack instance centra.</span><span class="sxs-lookup"><span data-stu-id="fbfba-379">Especially when the solution spans independent Azure Stack Hub instances.</span></span> <span data-ttu-id="fbfba-380">Kubernetes a Azure (včetně centra Azure Stack) mají pro řízení přístupu na základě role (RBAC) odlišné mechanismy:</span><span class="sxs-lookup"><span data-stu-id="fbfba-380">Kubernetes and Azure (including Azure Stack Hub) both have distinct mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="fbfba-381">Azure RBAC řídí přístup k prostředkům v Azure (a centra Azure Stack), včetně možnosti vytvářet nové prostředky Azure.</span><span class="sxs-lookup"><span data-stu-id="fbfba-381">Azure RBAC controls access to resources in Azure (and Azure Stack Hub), including the ability to create new Azure resources.</span></span> <span data-ttu-id="fbfba-382">Oprávnění lze přiřadit uživatelům, skupinám nebo instančním objektům.</span><span class="sxs-lookup"><span data-stu-id="fbfba-382">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="fbfba-383">(Instanční objekt je identita zabezpečení používaná aplikacemi.)</span><span class="sxs-lookup"><span data-stu-id="fbfba-383">(A service principal is a security identity used by applications.)</span></span>
- <span data-ttu-id="fbfba-384">Kubernetes RBAC řídí oprávnění k rozhraní Kubernetes API.</span><span class="sxs-lookup"><span data-stu-id="fbfba-384">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="fbfba-385">Například vytvoření lusků a výpisů lusků jsou akce, které mohou být autorizovány (nebo odepřeny) uživateli prostřednictvím RBAC.</span><span class="sxs-lookup"><span data-stu-id="fbfba-385">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="fbfba-386">K přiřazení oprávnění Kubernetes uživatelům můžete vytvářet role a vazby rolí.</span><span class="sxs-lookup"><span data-stu-id="fbfba-386">To assign Kubernetes permissions to users, you create roles and role bindings.</span></span>

<span data-ttu-id="fbfba-387">**Azure Stack identitu centra a RBAC**</span><span class="sxs-lookup"><span data-stu-id="fbfba-387">**Azure Stack Hub identity and RBAC**</span></span>

<span data-ttu-id="fbfba-388">Centrum Azure Stack poskytuje dvě volby zprostředkovatele identity.</span><span class="sxs-lookup"><span data-stu-id="fbfba-388">Azure Stack Hub provides two identity provider choices.</span></span> <span data-ttu-id="fbfba-389">Použitý poskytovatel závisí na prostředí a na tom, jestli je spuštěný v připojeném nebo odpojeném prostředí:</span><span class="sxs-lookup"><span data-stu-id="fbfba-389">The provider you use depends on the environment and whether running in a connected or disconnected environment:</span></span>

- <span data-ttu-id="fbfba-390">Azure AD – dá se použít jenom v připojeném prostředí.</span><span class="sxs-lookup"><span data-stu-id="fbfba-390">Azure AD - can only be used in a connected environment.</span></span>
- <span data-ttu-id="fbfba-391">ADFS na tradiční doménovou strukturu služby Active Directory – dá se použít v připojeném i odpojeném prostředí.</span><span class="sxs-lookup"><span data-stu-id="fbfba-391">ADFS to a traditional Active Directory forest - can be used in both a connected or disconnected environment.</span></span>

<span data-ttu-id="fbfba-392">Zprostředkovatel identity spravuje uživatele a skupiny, včetně ověřování a autorizace pro přístup k prostředkům.</span><span class="sxs-lookup"><span data-stu-id="fbfba-392">The identity provider manages users and groups, including authentication and authorization for accessing resources.</span></span> <span data-ttu-id="fbfba-393">Přístup se dá udělit Azure Stack prostředkům centra, jako jsou předplatná, skupiny prostředků a jednotlivé prostředky, jako jsou virtuální počítače nebo nástroje pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-393">Access can be granted to Azure Stack Hub resources like subscriptions, resource groups, and individual resources like VMs or load balancers.</span></span> <span data-ttu-id="fbfba-394">Chcete-li mít konzistentní model přístupu, měli byste zvážit použití stejných skupin (buď přímo, nebo vnořené) pro všechna centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-394">To have a consistent access model, you should consider using the same groups (either direct or nested) for all Azure Stack Hubs.</span></span> <span data-ttu-id="fbfba-395">Tady je příklad konfigurace:</span><span class="sxs-lookup"><span data-stu-id="fbfba-395">Here's a configuration example:</span></span>

![vnořené skupiny AAD se službou Azure Stack hub](media/pattern-highly-available-kubernetes/azure-stack-azure-ad-nested-groups.png)

<span data-ttu-id="fbfba-397">Příklad obsahuje vyhrazenou skupinu (pomocí AAD nebo ADFS) pro konkrétní účel.</span><span class="sxs-lookup"><span data-stu-id="fbfba-397">The example contains a dedicated group (using AAD or ADFS) for a specific purpose.</span></span> <span data-ttu-id="fbfba-398">Například pokud chcete poskytnout oprávnění přispěvatele pro skupinu prostředků, která obsahuje naši infrastrukturu clusteru Kubernetes na konkrétní instanci centra Azure Stack (tady je K8s Přispěvatel clusteru).</span><span class="sxs-lookup"><span data-stu-id="fbfba-398">For example, to provide Contributor permissions for the Resource Group that contains our Kubernetes cluster infrastructure on a specific Azure Stack Hub instance (here "Seattle K8s Cluster Contributor").</span></span> <span data-ttu-id="fbfba-399">Tyto skupiny jsou potom vnořené do celkové skupiny, která obsahuje "podskupiny" pro každé centrum Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-399">These groups are then nested into an overall group that contains the "subgroups" for each Azure Stack Hub.</span></span>

<span data-ttu-id="fbfba-400">Náš ukázkový uživatel teď bude mít oprávnění Přispěvatel pro obě skupiny prostředků, které obsahují celou sadu prostředků infrastruktury Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-400">Our sample user will now have "Contributor" permissions to both Resources Groups that contain the entire set of Kubernetes infrastructure resources.</span></span> <span data-ttu-id="fbfba-401">Uživatel bude mít přístup k prostředkům v obou instancích centra Azure Stack, protože instance sdílejí stejného poskytovatele identity.</span><span class="sxs-lookup"><span data-stu-id="fbfba-401">The user will have access to resources on both Azure Stack Hub instances, because the instances share the same identity provider.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fbfba-402">Tato oprávnění se týkají pouze centra Azure Stack a některých prostředků nasazených nad ním.</span><span class="sxs-lookup"><span data-stu-id="fbfba-402">These permissions affect only Azure Stack Hub and some of the resources deployed on top of it.</span></span> <span data-ttu-id="fbfba-403">Uživatel, který má tuto úroveň přístupu, může provádět spoustu škod, ale nemůže získat přístup k virtuálním počítačům Kubernetes IaaS ani k rozhraní Kubernetes API bez dalšího přístupu k nasazení Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-403">A user who has this level of access can do a lot of harm, but cannot access the Kubernetes IaaS VMs nor the Kubernetes API without additional access to the Kubernetes deployment.</span></span>

<span data-ttu-id="fbfba-404">**Kubernetes identity a RBAC**</span><span class="sxs-lookup"><span data-stu-id="fbfba-404">**Kubernetes identity and RBAC**</span></span>

<span data-ttu-id="fbfba-405">Cluster Kubernetes ve výchozím nastavení nepoužívá stejného poskytovatele identity jako Azure Stack centrum.</span><span class="sxs-lookup"><span data-stu-id="fbfba-405">A Kubernetes cluster, by default, doesn't use the same Identity Provider as the underlaying Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-406">Virtuální počítače hostující cluster Kubernetes, hlavní uzel a pracovní uzly používají klíč SSH, který je určen během nasazování clusteru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-406">The VMs hosting the Kubernetes cluster, the master, and worker nodes, use the SSH Key that is specified during the deployment of the cluster.</span></span> <span data-ttu-id="fbfba-407">Tento klíč SSH se musí připojit k těmto uzlům pomocí SSH.</span><span class="sxs-lookup"><span data-stu-id="fbfba-407">This SSH key is required to connect to these nodes using SSH.</span></span>

<span data-ttu-id="fbfba-408">Rozhraní Kubernetes API (například k používání pomocí `kubectl` ) je chráněno účty služeb, včetně výchozího účtu služby Správce clusteru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-408">The Kubernetes API (for example, accessed by using `kubectl`) is also protected by service accounts including a default "cluster admin" service account.</span></span> <span data-ttu-id="fbfba-409">Přihlašovací údaje pro tento účet služby se zpočátku ukládají do `.kube/config` souboru na hlavních Kubernetes uzlech.</span><span class="sxs-lookup"><span data-stu-id="fbfba-409">The credentials for this service account are initially stored in the `.kube/config` file on your Kubernetes master nodes.</span></span>

<span data-ttu-id="fbfba-410">**Správa tajných klíčů a přihlašovací údaje aplikací**</span><span class="sxs-lookup"><span data-stu-id="fbfba-410">**Secrets management and application credentials**</span></span>

<span data-ttu-id="fbfba-411">K ukládání tajných klíčů jako připojovacích řetězců nebo přihlašovacích údajů databáze je k dispozici několik možností, včetně:</span><span class="sxs-lookup"><span data-stu-id="fbfba-411">To store secrets like connection strings or database credentials there are several choices, including:</span></span>

- <span data-ttu-id="fbfba-412">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="fbfba-412">Azure Key Vault</span></span>
- <span data-ttu-id="fbfba-413">Tajné klíče Kubernetes</span><span class="sxs-lookup"><span data-stu-id="fbfba-413">Kubernetes Secrets</span></span>
- <span data-ttu-id="fbfba-414">řešení třetích stran, jako je HashiCorp trezor (běží na Kubernetes)</span><span class="sxs-lookup"><span data-stu-id="fbfba-414">3rd-Party solutions like HashiCorp Vault (running on Kubernetes)</span></span>

<span data-ttu-id="fbfba-415">Neukládejte tajné klíče ani přihlašovací údaje ve formátu prostého textu v konfiguračních souborech, kódu aplikace nebo ve skriptech.</span><span class="sxs-lookup"><span data-stu-id="fbfba-415">Do not store secrets or credentials in plaintext in your configuration files, application code, or within scripts.</span></span> <span data-ttu-id="fbfba-416">A neukládat je do systému správy verzí.</span><span class="sxs-lookup"><span data-stu-id="fbfba-416">And do not store them in a version control system.</span></span> <span data-ttu-id="fbfba-417">Místo toho by měla automatizace nasazení získávat tajné klíče podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="fbfba-417">Instead, the deployment automation should retrieve the secrets as needed.</span></span>

## <a name="patch-and-update"></a><span data-ttu-id="fbfba-418">Oprava a aktualizace</span><span class="sxs-lookup"><span data-stu-id="fbfba-418">Patch and update</span></span>

<span data-ttu-id="fbfba-419">Proces **opravy a aktualizace (PNU)** ve službě Azure Kubernetes je částečně automatizovaný.</span><span class="sxs-lookup"><span data-stu-id="fbfba-419">The **Patch and Update (PNU)** process in Azure Kubernetes Service is partially automated.</span></span> <span data-ttu-id="fbfba-420">Upgrady verze Kubernetes se spouštějí ručně, zatímco se aktualizace zabezpečení aplikují automaticky.</span><span class="sxs-lookup"><span data-stu-id="fbfba-420">Kubernetes version upgrades are triggered manually, while security updates are applied automatically.</span></span> <span data-ttu-id="fbfba-421">Tyto aktualizace můžou zahrnovat opravy zabezpečení operačního systému nebo aktualizace jádra.</span><span class="sxs-lookup"><span data-stu-id="fbfba-421">These updates can include OS security fixes or kernel updates.</span></span> <span data-ttu-id="fbfba-422">AKS neprovede automatické restartování těchto uzlů Linux k dokončení procesu aktualizace.</span><span class="sxs-lookup"><span data-stu-id="fbfba-422">AKS doesn't automatically reboot these Linux nodes to complete the update process.</span></span> 

<span data-ttu-id="fbfba-423">Proces PNU pro cluster Kubernetes nasazený pomocí modulu AKS v centru Azure Stack není spravován a zodpovídá za operátora clusteru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-423">The PNU process for a Kubernetes cluster deployed using AKS Engine on Azure Stack Hub is unmanaged, and is the responsibility of the cluster operator.</span></span> 

<span data-ttu-id="fbfba-424">AKS Engine pomáhá s těmito dvěma nejdůležitějšími úkoly:</span><span class="sxs-lookup"><span data-stu-id="fbfba-424">AKS Engine helps with the two most important tasks:</span></span>

- [<span data-ttu-id="fbfba-425">Upgrade na novější verzi image operačního systému Kubernetes a Base OS</span><span class="sxs-lookup"><span data-stu-id="fbfba-425">Upgrade to a newer Kubernetes and base OS image version</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-upgrade-to-a-newer-kubernetes-version)
- [<span data-ttu-id="fbfba-426">Upgrade jenom základní image operačního systému</span><span class="sxs-lookup"><span data-stu-id="fbfba-426">Upgrade the base OS image only</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-only-upgrade-the-os-image)

<span data-ttu-id="fbfba-427">Novější image základního operačního systému obsahují nejnovější opravy zabezpečení operačního systému a aktualizace jádra.</span><span class="sxs-lookup"><span data-stu-id="fbfba-427">Newer base OS images contain the latest OS security fixes and kernel updates.</span></span> 

<span data-ttu-id="fbfba-428">Mechanismus [bezobslužného upgradu](https://wiki.debian.org/UnattendedUpgrades) automaticky nainstaluje aktualizace zabezpečení vydané před tím, než bude k dispozici nová verze základní image operačního systému v tržišti Azure Stack hub.</span><span class="sxs-lookup"><span data-stu-id="fbfba-428">The [Unattended Upgrade](https://wiki.debian.org/UnattendedUpgrades) mechanism automatically installs security updates that are released before a new base OS image version is available in the Azure Stack Hub Marketplace.</span></span> <span data-ttu-id="fbfba-429">Bezobslužný upgrade je ve výchozím nastavení povolený a instaluje aktualizace zabezpečení automaticky, ale nerestartuje uzly clusteru Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-429">Unattended upgrade is enabled by default and installs security updates automatically, but does not reboot the Kubernetes cluster nodes.</span></span> <span data-ttu-id="fbfba-430">Restartování uzlů se dá automatizovat pomocí Open-source [ **k** Ubernetes **opětovného** spuštění **D** aemon (kured))](/azure/aks/node-updates-kured).</span><span class="sxs-lookup"><span data-stu-id="fbfba-430">Rebooting the nodes can be automated using the open-source [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span></span> <span data-ttu-id="fbfba-431">Kured sleduje uzly Linux, které vyžadují restart, a pak automaticky zpracuje přeplánování běžícího procesu lusků a restartování uzlu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-431">Kured watches for Linux nodes that require a reboot, then automatically handle the rescheduling of running pods and node reboot process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="fbfba-432">Požadavky na nasazení (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="fbfba-432">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="fbfba-433">Centrum Azure a Azure Stack zveřejňují stejná Azure Resource Manager rozhraní REST API.</span><span class="sxs-lookup"><span data-stu-id="fbfba-433">Azure and Azure Stack Hub expose the same Azure Resource Manager REST APIs.</span></span> <span data-ttu-id="fbfba-434">Tato rozhraní API jsou řešena jako jakýkoli jiný cloud Azure (Azure, Azure Čína 21Vianet, Azure Government).</span><span class="sxs-lookup"><span data-stu-id="fbfba-434">These APIs are addressed like any other Azure cloud (Azure, Azure China 21Vianet, Azure Government).</span></span> <span data-ttu-id="fbfba-435">Mezi cloudy můžou být rozdíly ve verzích rozhraní API a služba Azure Stack hub poskytuje jenom podmnožinu služeb.</span><span class="sxs-lookup"><span data-stu-id="fbfba-435">There may be differences in API versions between clouds, and Azure Stack Hub provides only a subset of services.</span></span> <span data-ttu-id="fbfba-436">Identifikátor URI koncového bodu správy se také liší pro každý Cloud a každou instanci centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-436">The management endpoint URI is also different for each cloud, and each instance of Azure Stack Hub.</span></span>

<span data-ttu-id="fbfba-437">Kromě uvedených drobných rozdílů nabízí Azure Resource Manager rozhraní REST API konzistentní způsob, jak pracovat s centrem Azure i Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-437">Aside from the subtle differences mentioned, Azure Resource Manager REST APIs provide a consistent way to interact with both Azure and Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-438">Tady se dá použít stejná sada nástrojů, jak by se používala s jakýmkoli jiným cloudem Azure.</span><span class="sxs-lookup"><span data-stu-id="fbfba-438">The same set of tools can be used here as would be used with any other Azure cloud.</span></span> <span data-ttu-id="fbfba-439">K nasazení a orchestraci služeb pro Azure Stack Hub můžete použít Azure DevOps, nástroje jako Jenkinse nebo PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fbfba-439">You can use Azure DevOps, tools like Jenkins, or PowerShell, to deploy and orchestrate services to Azure Stack Hub.</span></span>

<span data-ttu-id="fbfba-440">**Důležité informace**</span><span class="sxs-lookup"><span data-stu-id="fbfba-440">**Considerations**</span></span>

<span data-ttu-id="fbfba-441">Jedním z hlavních rozdílů v případě, že je Azure Stack nasazení centra, je otázka dostupnosti Internetu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-441">One of the major differences when it comes to Azure Stack Hub deployments is the question of Internet accessibility.</span></span> <span data-ttu-id="fbfba-442">Přístupnost internetu určuje, jestli se má pro úlohy CI/CD vybrat agent sestavení hostovaná Microsoftem nebo místním hostem.</span><span class="sxs-lookup"><span data-stu-id="fbfba-442">Internet accessibility determines whether to select a Microsoft-hosted or a self-hosted build agent for your CI/CD jobs.</span></span>

<span data-ttu-id="fbfba-443">Samoobslužný Agent může běžet na Azure Stackovém centru (jako virtuální počítač IaaS) nebo v podsíti sítě, která má přístup k centru Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-443">A self-hosted agent can run on top of Azure Stack Hub (as an IaaS VM) or in a network subnet that can access Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-444">Další informace o rozdílech najdete v části [agenti Azure Pipelines](/azure/devops/pipelines/agents/agents) .</span><span class="sxs-lookup"><span data-stu-id="fbfba-444">Go to [Azure Pipelines agents](/azure/devops/pipelines/agents/agents) to learn more about the differences.</span></span>

<span data-ttu-id="fbfba-445">Následující obrázek vám pomůže rozhodnout se, jestli potřebujete agenta sestavení hostovaného v místním prostředí nebo Microsoft hosta:</span><span class="sxs-lookup"><span data-stu-id="fbfba-445">The following image helps you to decide if you need a self-hosted or a Microsoft-hosted build agent:</span></span>

![Agenti sestavení v místním prostředí – Ano nebo ne](media/pattern-highly-available-kubernetes/aks-on-stack-self-hosted-build-agents-yes-or-no.png)

- <span data-ttu-id="fbfba-447">Mají přístup k koncovým bodům správy centra Azure Stack přes Internet?</span><span class="sxs-lookup"><span data-stu-id="fbfba-447">Are the Azure Stack Hub management endpoints accessible via Internet?</span></span>
  - <span data-ttu-id="fbfba-448">Ano: k připojení k centru Azure Stack můžete použít Azure Pipelines s agenty hostovanými Microsoftem.</span><span class="sxs-lookup"><span data-stu-id="fbfba-448">Yes: We can use Azure Pipelines with Microsoft-hosted agents to connect to Azure Stack Hub.</span></span>
  - <span data-ttu-id="fbfba-449">Ne: potřebujeme samoobslužné agenty, kteří se můžou připojit k koncovým bodům správy centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-449">No: We need self-hosted agents that can connect to Azure Stack Hub's management endpoints.</span></span>
- <span data-ttu-id="fbfba-450">Je náš cluster Kubernetes přístupný prostřednictvím Internetu?</span><span class="sxs-lookup"><span data-stu-id="fbfba-450">Is our Kubernetes cluster accessible via the Internet?</span></span>
  - <span data-ttu-id="fbfba-451">Ano: k přímé interakci s koncovým bodem rozhraní Kubernetes API můžeme použít Azure Pipelines s agenty hostovanými Microsoftem.</span><span class="sxs-lookup"><span data-stu-id="fbfba-451">Yes: We can use Azure Pipelines with Microsoft-hosted agents to interact directly with Kubernetes API endpoint.</span></span>
  - <span data-ttu-id="fbfba-452">Ne: potřebujeme samoobslužné agenty, kteří se můžou připojit ke koncovému bodu rozhraní API clusteru Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-452">No: We need self-hosted Agents that can connect to the Kubernetes cluster API endpoint.</span></span>

<span data-ttu-id="fbfba-453">Ve scénářích, kdy jsou koncové body správy centra Azure Stack a rozhraní Kubernetes API přístupné prostřednictvím Internetu, může nasazení použít agenta hostovaného Microsoftem.</span><span class="sxs-lookup"><span data-stu-id="fbfba-453">In scenarios where the Azure Stack Hub management endpoints and Kubernetes API are accessible via the internet, the deployment can use a Microsoft-hosted agent.</span></span> <span data-ttu-id="fbfba-454">Toto nasazení bude mít za následek architekturu aplikace následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="fbfba-454">This deployment will result in an application architecture as follows:</span></span>

<span data-ttu-id="fbfba-455">[![Přehled veřejné architektury](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="fbfba-455">[![Public architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span></span>

<span data-ttu-id="fbfba-456">Pokud Azure Resource Manager koncovým bodům, rozhraní Kubernetes API nebo obojím nemáte přímo přístup přes Internet, můžeme pro spuštění kroků kanálu využít samoobslužného agenta sestavení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-456">If the Azure Resource Manager endpoints, Kubernetes API, or both aren't directly accessible via the Internet, we can leverage a self-hosted build agent to run the pipeline steps.</span></span> <span data-ttu-id="fbfba-457">Tento návrh potřebuje méně připojení a dá se nasadit jenom s místními připojeními k síti do koncových bodů Azure Resource Manager a rozhraní Kubernetes API:</span><span class="sxs-lookup"><span data-stu-id="fbfba-457">This design needs less connectivity, and can be deployed with only on-premises network connectivity to Azure Resource Manager endpoints and the Kubernetes API:</span></span>

<span data-ttu-id="fbfba-458">[![Přehled architektury on-Prem](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="fbfba-458">[![On-prem architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span></span>

> [!NOTE]
> <span data-ttu-id="fbfba-459">**Jaké jsou informace o odpojených scénářích?**</span><span class="sxs-lookup"><span data-stu-id="fbfba-459">**What about disconnected scenarios?**</span></span> <span data-ttu-id="fbfba-460">Ve scénářích, kdy Azure Stack hub nebo Kubernetes nebo oba nemají koncové body správy, je stále možné využít Azure DevOps pro vaše nasazení.</span><span class="sxs-lookup"><span data-stu-id="fbfba-460">In scenarios where either Azure Stack Hub or Kubernetes or both of them do not have internet-facing management endpoints, it is still possible to use Azure DevOps for your deployments.</span></span> <span data-ttu-id="fbfba-461">Můžete buď použít samoobslužný fond agentů (což je DevOps agent, který je spuštěný místně, nebo Azure Stack v samotném rozbočovači), nebo zcela místně hostovaný Azure DevOps Server.</span><span class="sxs-lookup"><span data-stu-id="fbfba-461">You can either use a self-hosted Agent Pool (which is a DevOps Agent running on-premises or on Azure Stack Hub itself) or a completly self-hosted Azure DevOps Server on-premises.</span></span> <span data-ttu-id="fbfba-462">Samoobslužný agent potřebuje jenom odchozí připojení HTTPS (TCP/443) k Internetu.</span><span class="sxs-lookup"><span data-stu-id="fbfba-462">The self-hosted agent needs only outbound HTTPS (TCP/443) Internet connectivity.</span></span>

<span data-ttu-id="fbfba-463">Vzor může používat cluster Kubernetes (nasazený a orchestrující modul AKS) v každé instanci centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-463">The pattern can use a Kubernetes cluster (deployed and orchestrated with AKS engine) on each Azure Stack Hub instance.</span></span> <span data-ttu-id="fbfba-464">Zahrnuje aplikaci, která se skládá z front-endové služby back-endu (například MongoDB) a řadiče příchozího přenosu založeného na Nginx.</span><span class="sxs-lookup"><span data-stu-id="fbfba-464">It includes an application consisting of a frontend, a mid-tier, backend services (for example MongoDB), and an nginx-based Ingress Controller.</span></span> <span data-ttu-id="fbfba-465">Místo používání databáze hostované v clusteru K8s můžete využít "externí úložiště dat".</span><span class="sxs-lookup"><span data-stu-id="fbfba-465">Instead of using a database hosted on the K8s cluster, you can leverage "external data stores".</span></span> <span data-ttu-id="fbfba-466">Mezi možnosti databáze patří MySQL, SQL Server nebo jakýkoli druh databáze hostovaný mimo centrum Azure Stack nebo v IaaS.</span><span class="sxs-lookup"><span data-stu-id="fbfba-466">Database options include MySQL, SQL Server, or any kind of database hosted outside of Azure Stack Hub or in IaaS.</span></span> <span data-ttu-id="fbfba-467">Zde uvedené konfigurace nejsou v oboru.</span><span class="sxs-lookup"><span data-stu-id="fbfba-467">Configurations like this aren't in scope here.</span></span>

## <a name="partner-solutions"></a><span data-ttu-id="fbfba-468">Partnerská řešení</span><span class="sxs-lookup"><span data-stu-id="fbfba-468">Partner solutions</span></span>

<span data-ttu-id="fbfba-469">Existují Partnerská řešení Microsoftu, která můžou roztáhnout možnosti centra Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-469">There are Microsoft Partner solutions that can extend the capabilities of Azure Stack Hub.</span></span> <span data-ttu-id="fbfba-470">Tato řešení byla užitečná při nasazení aplikací spuštěných v clusterech Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="fbfba-470">These solutions have been found useful in deployments of applications running on Kubernetes clusters.</span></span>  

## <a name="storage-and-data-solutions"></a><span data-ttu-id="fbfba-471">Řešení úložiště a dat</span><span class="sxs-lookup"><span data-stu-id="fbfba-471">Storage and data solutions</span></span>

<span data-ttu-id="fbfba-472">Jak je popsáno v tématu [požadavky na data a úložiště](#data-and-storage-considerations), Azure Stack hub aktuálně nemá nativní řešení pro replikaci úložiště mezi několika instancemi.</span><span class="sxs-lookup"><span data-stu-id="fbfba-472">As described in [Data and storage considerations](#data-and-storage-considerations), Azure Stack Hub currently doesn't have a native solution to replicate storage across multiple instances.</span></span> <span data-ttu-id="fbfba-473">Na rozdíl od Azure neexistuje schopnost replikace úložiště napříč několika oblastmi.</span><span class="sxs-lookup"><span data-stu-id="fbfba-473">Unlike Azure, the capability of replicating storage across multiple regions does not exist.</span></span> <span data-ttu-id="fbfba-474">V Azure Stackovém centru je každá instance svým vlastním jedinečným cloudem.</span><span class="sxs-lookup"><span data-stu-id="fbfba-474">In Azure Stack Hub, each instance is its own distinct cloud.</span></span> <span data-ttu-id="fbfba-475">Ale řešení jsou dostupná od partnerů Microsoftu, která umožňují replikaci úložiště napříč Azure Stackmi rozbočovači a Azure.</span><span class="sxs-lookup"><span data-stu-id="fbfba-475">However, solutions are available from Microsoft Partners that enable storage replication across Azure Stack Hubs and Azure.</span></span> 

<span data-ttu-id="fbfba-476">**ŠKÁLOVATELNOST**</span><span class="sxs-lookup"><span data-stu-id="fbfba-476">**SCALITY**</span></span>

<span data-ttu-id="fbfba-477">[Škálovatelnost](https://www.scality.com/) přináší úložiště na úrovni webu, které používá digitální firmy od 2009.</span><span class="sxs-lookup"><span data-stu-id="fbfba-477">[Scality](https://www.scality.com/) delivers web-scale storage that has powered digital businesses since 2009.</span></span> <span data-ttu-id="fbfba-478">KANÁL pro škálovatelnost, který má naše softwarově definované úložiště, převede komoditní servery na neomezený fond úložiště pro libovolný typ dat – soubor a objekt – v řádu petabajtů měřítku.</span><span class="sxs-lookup"><span data-stu-id="fbfba-478">The Scality RING, our software-defined storage, turns commodity x86 servers into an unlimited storage pool for any type of data –file and object– at petabyte scale.</span></span>

<span data-ttu-id="fbfba-479">**CLOUDIAN**</span><span class="sxs-lookup"><span data-stu-id="fbfba-479">**CLOUDIAN**</span></span>

<span data-ttu-id="fbfba-480">[Cloudian](https://www.cloudian.com/) zjednodušuje podnikové úložiště s neomezeným škálovatelným úložištěm, které konsoliduje obrovských datových sad do jediného snadno spravovaného prostředí.</span><span class="sxs-lookup"><span data-stu-id="fbfba-480">[Cloudian](https://www.cloudian.com/) simplifies enterprise storage with limitless scalable storage that consolidates massive data sets to a single, easily managed environment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fbfba-481">Další kroky</span><span class="sxs-lookup"><span data-stu-id="fbfba-481">Next steps</span></span>

<span data-ttu-id="fbfba-482">Další informace o konceptech představených v tomto článku:</span><span class="sxs-lookup"><span data-stu-id="fbfba-482">To learn more about concepts introduced in this article:</span></span>

- <span data-ttu-id="fbfba-483">[Škálování mezi cloudy](pattern-cross-cloud-scale.md) a [geograficky distribuované aplikace](pattern-geo-distributed.md) v centru Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="fbfba-483">[Cross-cloud scaling](pattern-cross-cloud-scale.md) and [Geo-distributed app patterns](pattern-geo-distributed.md) in Azure Stack Hub.</span></span>
- <span data-ttu-id="fbfba-484">[Architektura mikroslužeb ve službě Azure Kubernetes (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span><span class="sxs-lookup"><span data-stu-id="fbfba-484">[Microservices architecture on Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span></span>

<span data-ttu-id="fbfba-485">Až budete připraveni otestovat příklad řešení, pokračujte pomocí [Průvodce nasazením clusteru s vysokou dostupností Kubernetes](solution-deployment-guide-highly-available-kubernetes.md).</span><span class="sxs-lookup"><span data-stu-id="fbfba-485">When you're ready to test the solution example, continue with the [High availability Kubernetes cluster deployment guide](solution-deployment-guide-highly-available-kubernetes.md).</span></span> <span data-ttu-id="fbfba-486">Průvodce nasazením poskytuje podrobné pokyny pro nasazení a testování jeho komponent.</span><span class="sxs-lookup"><span data-stu-id="fbfba-486">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>